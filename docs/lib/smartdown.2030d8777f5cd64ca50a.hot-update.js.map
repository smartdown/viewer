{"version":3,"sources":["webpack://smartdown/../node_modules/highlight.js/styles/default.css?409c","webpack://smartdown/../node_modules/leaflet/dist/leaflet.css?1c9f","webpack://smartdown/./index.js","webpack://smartdown/./styles.css?2aa4"],"names":["String","prototype","endsWith","search","thisLen","undefined","length","substring","Element","addEventListener","runListeners","oEvent","window","event","iLstId","iElId","oEvtListeners","oListeners","type","aEls","aEvts","call","sEventType","fListener","hasOwnProperty","nElIdx","push","aElListeners","splice","removeEventListener","twitterLoading","each","lodashEach","require","map","lodashMap","localForage","useLocalForage","localForageSmartdownPrefix","jsyaml","StackTrace","importScriptUrl","sSrc","fOnload","fOnerror","oHead","document","head","getElementsByTagName","loadError","oError","URIError","target","src","oScript","createElement","onerror","appendChild","onload","evt","importTextUrl","url","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseText","open","send","jsModules","loadExternal","external","loaded","loader","console","log","loadedCallbacks","unshift","script1","callThese","forEach","loadedCb","Stdlib","useStdlib","loadStdlib","stdlib","then","default","stdlibPackage","Object","keys","slot","catch","error","vdomToHtml","datasets","loadSOTU","sotu","P5Loader","P5VarDefs","P5UserFunctionDefs","P5SystemVarDecls","P5SystemVarUpdates","P5SystemVarDefs","P5UserFunctions","P5SystemVars","P5LoaderPrototypeInfo","useP5JS","loadP5JS","p5js","p5DOM","p5Sound","p5","isTesting","process","env","TEST_RUN","hasFocus","implicitP5VarDefs","f","indexOf","val","loadFontWrapper","createCanvasWrapper","join","implicitP5SystemVarDecls","implicitP5SystemVarUpdates","implicitP5SystemVarDefs","implicitP5UserFunctionDefs","userFunctionSource","Three","useThree","loadThree","three","threePackage","LDF","useLDF","loadLDF","ldf","ldfPackage","Brython","useBrython","loadBrython","brython","debugging","baseURL","script2","mathjaxConfigure","MathJax","Hub","Config","disabled","TeX","MultLineWidth","equationNumbers","autoNumber","extensions","xypicURL","tex2jax","inlineMath","displayMath","processEscapes","skipTags","asciimath2jax","delimiters","skipStartupTypeset","displayAlign","positionToHash","Register","MessageHook","message","lastError","Plotly","usePlotly","loadPlotly","plotly","script","plotlyPackage","d3v5","d3sankey","sankey","D3","useD3","loadD3","d3","smartdown","d3cloud","topojson","wcl","d3fc","d3dc","config","defaultColors","schemeAccent","d3dcCSS","Viz","useGraphviz","loadGraphviz","graphviz","registerMediaWithGraphviz","mermaid","mermaidAPI","fixupMermaidSVG","svgCode","replace","beginStyleTag","endStyleTag","beginStyle","endStyle","svgStyle","slice","trim","svgStyleLines","split","svgNewStyleLines","line","bracePos","selectors","body","selectorsNew","newLine","svgNewStyle","mermaidRender","div","code","classList","add","render","id","svgCodeNew","innerHTML","useMermaid","initializeMermaid","startOnLoad","cloneCssStyles","logLevel","htmlLabels","fontSize","flowchart","useMaxWidth","sequenceDiagram","diagramMarginX","diagramMarginY","actorMargin","width","height","boxMargin","boxTextMargin","noteMargin","messageMargin","mirrorActors","bottomMarginAdj","ganttchart","titleTopMargin","barHeight","barGap","topPadding","sidePadding","gridLineStartPadding","numberSectionStyles","initialize","loadMermaid","playableArgNames","Leaflet","useLeaflet","Icon","Default","_getIconUrl","L","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","global","hljs","registerLanguage","cardLoader","calcHandlers","linkRules","currentHomeDiv","currentMD","playableTypes","highlight","javascript","transform","perPageState","expressionsRegistered","playablesRegistered","playablesRegisteredOrder","currentRenderDiv","currentBackpatches","cellIndex","smartdownCells","cardLoading","smartdownVariables","smartdownScripts","smartdownScriptsMap","mediaRegistry","scriptIndex","markedModule","escapeQuotes","s","escapeSingle","entityEscape","html","encode","globalescape","escape","windowescape","markedOpts","renderer","gfm","tables","breaks","gfmBreaks","pedantic","sanitize","smartLists","smartypants","lang","playableType","result","mappedLanguage","highlightAuto","value","expandHrefWithLinkRules","href","i","rule","prefix","newHRef","location","origin","replacer","graphvizImages","data","_key","path","unescapeMap","createEscaper","escaper","match","source","testRegexp","RegExp","replaceRegexp","string","test","decodeInlineScript","getServiceOrigin","protocol","youtubeDimensions","thumbnail","halfwidth","fullwidth","youtubeClasses","uniqueYouTubeId","convertYoutubeFragmentToEmbed","title","titleParts","shortPrefixes","longPrefixes","sizing","every","suffix","substr","enablejsapi","apiButton","apiPlayerKey","apiParts","convertVimeoFragmentToEmbed","opts","areValuesSameEnough","oldValue","newValue","JSON","stringify","recursivelyLoadIncludes","prefixCode","language","includesRemaining","done","nextInclude","shift","nextIncludeText","errorText","getPrelude","imports","includes","loadableLanguages","lines","usePrefix","includePrefix","rhs","renderCodeInternal","renderDivId","prelude","languageElements","languageOpts","playable","autoplay","debug","scriptId","divId","preId","dbgId","dbgToggleId","functionId","playId","stopId","progressId","registeredPlayable","registerPlayable","playableScript","transformedCode","augmentedCode","highlightLanguage","highlightedCode","highlightedAugmentedCode","showAugmentedCode","debugIsHidden","playableWrapper","playableButtons","playableCodeDisplay","baseCodeRenderer","renderCode","baseLanguage","bp","backpatchIndex","deferredCode","backpatch","key","includedCode","saveRenderDiv","renderedExpandedCode","patch","edit","regex","opt","name","getRegex","smartdownLexer","out","link","text","cap","prevCapZero","mathRules","kludgeGFMURLRules","exec","escaped","rules","autolink","mangle","inLink","_backpedal","tag","options","sanitizer","outputLink","InlineLexer","escapes","reflink","nolink","links","toLowerCase","charAt","strong","output","em","codespan","br","del","Error","charCodeAt","isGifferable","renderImage","specialClass","mediaLink","lastIndexOf","pathElements","reverse","e1","pop","e2","imageName","imageClass","fgClass","media","inlineData","svgData","showCards","xhtml","youtubeEmbed","vimeoEmbed","bgColor","styles","className","importCssCode","cssCode","styleElement","styleSheet","cssText","createTextNode","renderLink","smartdownTag","useNewWindow","handled","titleAttr","linkHead","linkBody","lowerhref","linkTail","cellscript","op","lhs","exprs","eqIndex","e","parts2","parts","newHTML","hasLabel","inputCellId","inputCellIdParts","inputType","liveBlur","cellBinding","cellID","cellType","datatype","decodeURIComponent","inputRangeCellId","lhsElements","min","max","step","inputCheckboxCellId","manualInvoke","expr","registerExpression","exprId","labelId","labelText","outputCellId","outputCellIdParts","outputType","smartdownClass","renderParagraph","renderBr","disclosableDivsOpened","renderHeading","level","raw","disclosableDeclaration","baseHeadingRenderer","enhanceMarkedAndOpts","bind","Renderer","self","image","paragraph","heading","partitionMultipart","markdown","splits","firstKey","defaultKeyName","lhss","rhss","manual","types","calcCellIdParts","calcType","rootDivId","computeExpressions","entry","rootDiv","getElementById","labelElement","expandStringWithSubstitutions","computeExpression","brythonScriptId","playing","dependLastValues","embedThis","index","playPlayableInternal","divPre","play","stop","progress","style","display","argvalues","module","exports","dependOn","depend","atExitHandlers","atExit","func","Function","embedResult","apply","leafletMap","_ontouchend","clientX","pageX","clientY","pageY","_updateTouchCoords","_updateNextMouseCoords","touches","_setProperty","context","_isGlobal","executeDefault","touchEnded","preventDefault","mouseReleased","IAMP5","keydownHandler","ignoreKeys","myP5","LEFT_ARROW","RIGHT_ARROW","UP_ARROW","DOWN_ARROW","tagName","keyCode","frameRate","_onresize","lastValues","possiblyModifiedProgressDiv","signal","atLeastOneUndefined","varname","images","renderString","recursivelyLoadImports","importsRemaining","nextImport","playPlayable","resetPlayable","throwAway","remove","canvas","removeChild","isGodownMain","Godown_Shutdown","toggleDebug","newStyle","activatePopup","trigger","position","top","offsetTop","offsetHeight","padding","popupWidth","Math","floor","innerWidth","offsetLeft","left","popupLeft","offsetWidth","toggle","deactivatePopup","toggleDisclosureButton","disclosureType","willBeOpen","contains","openedSpan","closedSpan","toggleDisclosure","pause","getAudioContext","suspend","resume","handleVisibilityChange","hidden","startAutoplay","outputDiv","sel","divHere","querySelectorAll","resetPerPageState","cleanupOrphanedStuff","newER","element","newPRO","newPR","element1","element2","deleted","resetAllPlayables","playableElement","transformPlayables","playablesToTransform","godownTranslate","recursiveTransform","packageIndex","packageEndIndex","packageName","divAccessCode","transformedCodeResult","configure","configurationCompletedHandler","loadedHandler","_baseURL","_cardLoader","_calcHandlers","_linkRules","navigator","userAgent","MSStream","querySelector","setAttribute","setLinkRules","svgLoaded","sourceText","svgKey","expandedurl","oReq","st","getSync","currentBase","fileName","lastSlash","__webpack_public_path__","delayStartupUntil","AuthorInit","Ajax","fileRev","file","ver","cdnFileVersions","cdnVersion","setTimeout","completeStartup","useMathJax","StartupHook","Configured","patchesUnresolvedKludgeLimit","renderCell","variableId","cellInfo","checked","stringified","setSmartdown","Array","isArray","isImage","elementType","isURLTitle","elementList","elementIndex","newElement","propagateModel","ensureCells","ensureVariables","v","k","propagateChangedVariable","updateProcesses","newCell","changeVariable","force","resetVariables","scrollHoverDisableEnabled","lastY","setupScrollHoverDisable","timer","currentY","scrollY","delta","abs","clearTimeout","md","completeTypeset","that","resizeTimeout","actualResizeHandler","d","newLayout","autosize","PLOT_TITLE","relayout","resizeThrottler","finishLoad","twttr","widgets","load","playButtonStyles","playButtonIconStyles","onresize","firstTweetIndex","frontMatterText","frontMatterBegin","frontMatterEndIndex","frontMatter","safeLoad","applyBackpatches","patchesUnresolved","finishIt","renderDiv","Typeset","setHome","setVariable","Number","setVariables","assignments","assignment","computeStoredExpression","newExpr","varName","varValue","calcParts","bracketIndex","slashIndex","calcKey","calcBody","calcHandler","vars","vals","numPending","goToCard","cardKey","modelAsMarkdown","scriptx","loadCardsFromDocumentScripts","scripts","getMedia","mediaKey","youtubeIframeAPILoaded","youtubeIframeAPILoadedCbs","onYouTubeIframeAPIReady","cb","loadYouTubeIframeAPI","setupYouTubePlayer","playerDiv","player","YT","Player","events","tweek","marked","version"],"mappings":"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","file":"smartdown.2030d8777f5cd64ca50a.hot-update.js","sourcesContent":["// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// 'use strict';\n\n//\n// Smartdown\n// Copyright 2015, Daniel B Keith\n//\n\n/* eslint no-var: 0 */\n/* eslint prefer-arrow-callback: 0 */\n/* eslint no-useless-escape: 0 */\n/* eslint prefer-template: 0 */\n/* eslint no-multi-spaces: 0 */\n/* eslint global-require: 0 */\n/* eslint no-param-reassign: 0 */\n/* eslint no-continue: 0 */\n/* eslint no-else-return: 0 */\n/* eslint no-plusplus: 0 */\n/* eslint vars-on-top: 0 */\n/* eslint quote-props: 0 */\n/* eslint object-shorthand: 0 */\n/* eslint func-names: 0 */\n/* eslint no-underscore-dangle: 0 */\n/* eslint import/extensions: 0 */\n/* eslint import/newline-after-import: 0 */\n/* eslint import/first: 0 */\n/* eslint import/no-extraneous-dependencies: 0 */\n/* eslint import/no-unresolved: 0 */\n/* global document */\n/* global window */\n\n/* global useLocalForage */\n/* global useLeaflet */\n/* global useGraphviz */\n/* global useBrython */\n/* global useD3 */\n/* global useLDF */\n/* global usePlotly */\n/* global useP5JS */\n/* global useMathJax */\n/* global useStdlib */\n/* global useMermaid */\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith#Polyfill\nif (!String.prototype.endsWith) {\n  String.prototype.endsWith = function (search, thisLen) {\n    if (thisLen === undefined || thisLen > this.length) {\n      thisLen = this.length;\n    }\n    return this.substring(thisLen - search.length, thisLen) === search;\n  };\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener#Polyfill_to_support_older_browsers\n/* global Element */\nif (!Element.prototype.addEventListener) {\n  var oListeners = {};\n  function runListeners(oEvent) {\n    if (!oEvent) {\n      oEvent = window.event;\n    }\n    for (\n      var iLstId = 0, iElId = 0, oEvtListeners = oListeners[oEvent.type];\n      iElId < oEvtListeners.aEls.length;\n      iElId++) {\n      if (oEvtListeners.aEls[iElId] === this) {\n        for (\n          iLstId;\n          iLstId < oEvtListeners.aEvts[iElId].length;\n          iLstId++) {\n          oEvtListeners.aEvts[iElId][iLstId].call(this, oEvent);\n        }\n        break;\n      }\n    }\n  }\n  Element.prototype.addEventListener = function (sEventType, fListener /* , useCapture (will be ignored!) */) {\n    if (oListeners.hasOwnProperty(sEventType)) {\n      var oEvtListeners = oListeners[sEventType];\n      var nElIdx;\n      var iElId;\n      for (nElIdx = -1, iElId = 0; iElId < oEvtListeners.aEls.length; iElId++) {\n        if (oEvtListeners.aEls[iElId] === this) {\n          nElIdx = iElId;\n          break;\n        }\n      }\n      if (nElIdx === -1) {\n        oEvtListeners.aEls.push(this);\n        oEvtListeners.aEvts.push([fListener]);\n        this['on' + sEventType] = runListeners;\n      }\n      else {\n        var aElListeners = oEvtListeners.aEvts[nElIdx];\n        if (this['on' + sEventType] !== runListeners) {\n          aElListeners.splice(0);\n          this['on' + sEventType] = runListeners;\n        }\n        for (var iLstId = 0; iLstId < aElListeners.length; iLstId++) {\n          if (aElListeners[iLstId] === fListener) {\n            return;\n          }\n        }\n        aElListeners.push(fListener);\n      }\n    }\n    else {\n      oListeners[sEventType] = { aEls: [this], aEvts: [[fListener]] };\n      this['on' + sEventType] = runListeners;\n    }\n  };\n  Element.prototype.removeEventListener = function (sEventType, fListener /* , useCapture (will be ignored!) */) {\n    if (!oListeners.hasOwnProperty(sEventType)) {\n      return;\n    }\n    var oEvtListeners = oListeners[sEventType];\n    var nElIdx;\n    var iElId;\n    for (nElIdx = -1, iElId = 0; iElId < oEvtListeners.aEls.length; iElId++) {\n      if (oEvtListeners.aEls[iElId] === this) {\n        nElIdx = iElId;\n        break;\n      }\n    }\n    if (nElIdx === -1) {\n      return;\n    }\n    for (var iLstId = 0, aElListeners = oEvtListeners.aEvts[nElIdx]; iLstId < aElListeners.length; iLstId++) {\n      if (aElListeners[iLstId] === fListener) {\n        aElListeners.splice(iLstId, 1);\n      }\n    }\n  };\n}\n\nvar twitterLoading = false;\n\nconst each = window.lodashEach = require('lodash/forEach');\nconst map = window.lodashMap = require('lodash/map');\n\nlet localForage = {};\nif (useLocalForage) {\n  localForage = require('localforage');\n}\n\nconst localForageSmartdownPrefix = 'smartdownVariable/';\n\nwindow.jsyaml = require('js-yaml');\n\nconst StackTrace = require('stacktraceJS');\n\nfunction importScriptUrl(sSrc, fOnload, fOnerror) {\n  var oHead = document.head || document.getElementsByTagName('head')[0];\n  function loadError(oError) {\n    if (fOnerror) {\n      fOnerror(oError);\n    }\n    else {\n      throw new URIError('The script ' + oError.target.src + ' is not accessible.');\n    }\n  }\n\n  var oScript = document.createElement('script');\n  oScript.type = 'text\\/javascript';\n  oScript.onerror = loadError;\n  oHead.appendChild(oScript);\n  if (fOnload) {\n    oScript.onload = function (evt) {\n      fOnload(evt);\n    };\n  }\n  oScript.src = sSrc;\n}\n\n\nfunction importTextUrl(url, fOnload, fOnerror) {\n  // console.log('importTextUrl', url);\n  /* global XMLHttpRequest */\n  var xhr = new XMLHttpRequest();\n  xhr.onreadystatechange = function () {\n    if (this.readyState === 4) {\n      if (this.status === 200) {\n        fOnload(this.responseText);\n      }\n      else {\n        // console.log('failed', this);\n        fOnerror(this.status);\n      }\n    }\n  };\n  xhr.open('GET', url);\n  xhr.send();\n}\n\n\nvar jsModules = {\n};\n\n\nfunction loadExternal(external, loaded) {\n  // console.log('loadExternal...', external);\n  if (!jsModules[external]) {\n    jsModules[external] = {\n      loader: function() {\n        console.log('why you callin loadExternal', external);\n      },\n      loaded: null,\n      loadedCallbacks: []\n    };\n  }\n\n  if (jsModules[external].loaded) {\n    loaded();\n  }\n  else if (jsModules[external].loadedCallbacks.length > 0) {\n    jsModules[external].loadedCallbacks.unshift(loaded);\n    // console.log('loadExternal...External is still loading', external);\n  }\n  else {\n    jsModules[external].loadedCallbacks.unshift(loaded);\n    // console.log('loadExternal...External initiate load', external);\n\n    importScriptUrl(\n      external,\n      function(script1) {\n        // console.log('loadExternal...load complete', external);\n        const callThese = jsModules[external].loadedCallbacks;\n        jsModules[external].loaded = true;\n        jsModules[external].loadedCallbacks = [];\n        callThese.forEach(loadedCb => {\n          loadedCb();\n        });\n      });\n  }\n}\n\n\nvar Stdlib = {};\nif (useStdlib) {\n  Stdlib.vdomToHtml = require('vdom-to-html');\n  Stdlib.datasets = {\n    'stopwords-en': require('stdlibDatasets/stopwords-en'),\n  };\n\n  Stdlib.loadSOTU = function loadSOTU(loaded) {\n    // require.ensure(\n    //  dependencies: String[],\n    //  callback: function(require),\n    //  errorCallback: function(error),\n    //  chunkName: String)\n    // require.ensure(\n    //   [],\n    //   function (require) {\n    //     const sotu = require('@stdlib/datasets/sotu/lib/browser_db.js');\n    //     Stdlib.datasets['sotu-data'] = sotu;\n    //     loaded();\n    //   },\n    //   function (error) {\n    //     console.log('loadSOTU error', error);\n    //   },\n    //   'stdlib-sotu',\n    // );\n\n    import(/* webpackChunkName: \"stdlib-sotu\" */ 'stdlibSOTU')  // @stdlib/datasets/sotu/lib/browser_db.js')\n    // import('stdlibSOTU')  // @stdlib/datasets/sotu/lib/browser_db.js')\n      .then(sotu => {\n        // console.log('loadSOTU success', Stdlib, sotu, sotu.default);\n        Stdlib.datasets['sotu-data'] = sotu.default;\n        loaded();\n      })\n      .catch(error => {\n        console.log('loadSOTU error', error);\n      });\n  };\n\n  function loadStdlib(loaded) {\n    // console.log('loadStdlib...', loaded, JSON.stringify(jsModules.stdlib.loadedCallbacks, null, 2));\n    if (jsModules.stdlib.loaded) {\n      loaded();\n    }\n    else if (jsModules.stdlib.loadedCallbacks.length > 0) {\n      jsModules.stdlib.loadedCallbacks.unshift(loaded);\n      // console.log('loadStdlib...stdlib is still loading', JSON.stringify(jsModules.stdlib.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.stdlib.loadedCallbacks.unshift(loaded);\n      // console.log('loadStdlib...stdlib initiate load', jsModules.stdlib.loadedCallbacks[0]);\n      import(/* webpackChunkName: \"stdlib\" */ '@stdlib/stdlib/dist/stdlib-tree.min.js')\n      // import('@stdlib/stdlib/dist/stdlib-tree.min.js')\n        .then(stdlib => {\n          // console.log('loadStdlib...import success', jsModules.stdlib.loadedCallbacks[0]);\n          // console.log(stdlib);\n          jsModules.stdlib.loaded = stdlib.default;\n          const stdlibPackage = stdlib.default;\n          Object.keys(stdlibPackage).forEach(slot => {\n            // console.log('...slot', slot, stdlibPackage[slot]);\n            Stdlib[slot] = stdlibPackage[slot];\n          });\n\n          const callThese = jsModules.stdlib.loadedCallbacks;\n          jsModules.stdlib.loadedCallbacks = [];\n          callThese.forEach(loadedCb => {\n            loadedCb();\n          });\n        })\n        .catch(error => {\n          console.log('loadStdlib error', error);\n        });\n    }\n  }\n\n  // Stdlib.loadStdlib = loadStdlib;\n  jsModules.stdlib = {\n    loader: loadStdlib,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\nvar P5Loader = {};\n\nvar P5VarDefs = null;\nvar P5UserFunctionDefs = null;\nvar P5SystemVarDecls = null;\nvar P5SystemVarUpdates = null;\nvar P5SystemVarDefs = null;\n\n// From https://github.com/processing/p5.js/blob/master/utils/sample-linter.js\nvar P5UserFunctions = [\n  'draw',\n  'setup',\n  'preload',\n  'mousePressed',\n  'mouseDragged',\n  'mouseMoved',\n  'mouseReleased',\n  'mouseClicked',\n  'mouseWheel',\n  'doubleClicked',\n  'windowResized',\n  'touchStarted',\n  'touchMoved',\n  'touchEnded',\n  'deviceMoved',\n  'deviceTurned',\n  'deviceShaken',\n  'keyPressed',\n  'keyReleased',\n  'keyTyped'\n];\n// P5UserFunctions = P5UserFunctions.slice(0, 2);\n\nvar P5SystemVars = [\n  'canvas',\n  'frameCount',\n\n  'width',\n  'height',\n  'windowWidth',\n  'windowHeight',\n\n  'mouseX',\n  'mouseY',\n  'winMouseX',\n  'winMouseY',\n  'pmouseX',\n  'pmouseY',\n  'pwinMouseX',\n  'pwinMouseY',\n  'mouseButton',\n  'mouseIsPressed',\n  'touches',\n\n  'pAccelerationX',\n  'pAccelerationY',\n  'pAccelerationZ',\n  'pRotationX',\n  'pRotationY',\n  'pRotationZ',\n  'pAccelerationX',\n  'pAccelerationY',\n  'deviceOrientation',\n  'turnAxis',\n\n  'key',\n  'isKeyPressed',\n  'keyIsPressed',\n  'keyCode',\n];\n// P5SystemVars = P5SystemVars.slice(0, 2);\n\n\n// Generated with:\n//  for (let f in P5Loader.prototype) {\n//    console.log(f, typeof P5Loader.prototype[f]);\n//\n\nconst P5LoaderPrototypeInfo = {\n  '_initializeInstanceVariables': 'function',\n  'P2D': 'string',\n  'WEBGL': 'string',\n  'ARROW': 'string',\n  'CROSS': 'string',\n  'HAND': 'string',\n  'MOVE': 'string',\n  'TEXT': 'string',\n  'WAIT': 'string',\n  'HALF_PI': 'number',\n  'PI': 'number',\n  'QUARTER_PI': 'number',\n  'TAU': 'number',\n  'TWO_PI': 'number',\n  'DEGREES': 'string',\n  'RADIANS': 'string',\n  'DEG_TO_RAD': 'number',\n  'RAD_TO_DEG': 'number',\n  'CORNER': 'string',\n  'CORNERS': 'string',\n  'RADIUS': 'string',\n  'RIGHT': 'string',\n  'LEFT': 'string',\n  'CENTER': 'string',\n  'TOP': 'string',\n  'BOTTOM': 'string',\n  'BASELINE': 'string',\n  'POINTS': 'number',\n  'LINES': 'number',\n  'LINE_STRIP': 'number',\n  'LINE_LOOP': 'number',\n  'TRIANGLES': 'number',\n  'TRIANGLE_FAN': 'number',\n  'TRIANGLE_STRIP': 'number',\n  'QUADS': 'string',\n  'QUAD_STRIP': 'string',\n  'CLOSE': 'string',\n  'OPEN': 'string',\n  'CHORD': 'string',\n  'PIE': 'string',\n  'PROJECT': 'string',\n  'SQUARE': 'string',\n  'ROUND': 'string',\n  'BEVEL': 'string',\n  'MITER': 'string',\n  'RGB': 'string',\n  'HSB': 'string',\n  'HSL': 'string',\n  'AUTO': 'string',\n  'ALT': 'number',\n  'BACKSPACE': 'number',\n  'CONTROL': 'number',\n  'DELETE': 'number',\n  'DOWN_ARROW': 'number',\n  'ENTER': 'number',\n  'ESCAPE': 'number',\n  'LEFT_ARROW': 'number',\n  'OPTION': 'number',\n  'RETURN': 'number',\n  'RIGHT_ARROW': 'number',\n  'SHIFT': 'number',\n  'TAB': 'number',\n  'UP_ARROW': 'number',\n  'BLEND': 'string',\n  'ADD': 'string',\n  'DARKEST': 'string',\n  'LIGHTEST': 'string',\n  'DIFFERENCE': 'string',\n  'EXCLUSION': 'string',\n  'MULTIPLY': 'string',\n  'SCREEN': 'string',\n  'REPLACE': 'string',\n  'OVERLAY': 'string',\n  'HARD_LIGHT': 'string',\n  'SOFT_LIGHT': 'string',\n  'DODGE': 'string',\n  'BURN': 'string',\n  'THRESHOLD': 'string',\n  'GRAY': 'string',\n  'OPAQUE': 'string',\n  'INVERT': 'string',\n  'POSTERIZE': 'string',\n  'DILATE': 'string',\n  'ERODE': 'string',\n  'BLUR': 'string',\n  'NORMAL': 'string',\n  'ITALIC': 'string',\n  'BOLD': 'string',\n  '_DEFAULT_TEXT_FILL': 'string',\n  '_DEFAULT_LEADMULT': 'number',\n  '_CTX_MIDDLE': 'string',\n  'LINEAR': 'string',\n  'QUADRATIC': 'string',\n  'BEZIER': 'string',\n  'CURVE': 'string',\n  'STROKE': 'string',\n  'FILL': 'string',\n  'TEXTURE': 'string',\n  'IMMEDIATE': 'string',\n  'LANDSCAPE': 'string',\n  'PORTRAIT': 'string',\n  '_DEFAULT_STROKE': 'string',\n  '_DEFAULT_FILL': 'string',\n  '_preloadMethods': 'object',\n  '_registeredMethods': 'object',\n  '_registeredPreloadMethods': 'object',\n  'registerPreloadMethod': 'function',\n  'registerMethod': 'function',\n  '_createFriendlyGlobalFunctionBinder': 'function',\n  '_helpForMisusedAtTopLevelCode': 'function',\n  'alpha': 'function',\n  'blue': 'function',\n  'brightness': 'function',\n  'color': 'function',\n  'green': 'function',\n  'hue': 'function',\n  'lerpColor': 'function',\n  'lightness': 'function',\n  'red': 'function',\n  'saturation': 'function',\n  'background': 'function',\n  'clear': 'function',\n  'colorMode': 'function',\n  'fill': 'function',\n  'noFill': 'function',\n  'noStroke': 'function',\n  'stroke': 'function',\n  'float': 'function',\n  'int': 'function',\n  'str': 'function',\n  'boolean': 'function',\n  'byte': 'function',\n  'char': 'function',\n  'unchar': 'function',\n  'hex': 'function',\n  'unhex': 'function',\n  'append': 'function',\n  'arrayCopy': 'function',\n  'concat': 'function',\n  'reverse': 'function',\n  'shorten': 'function',\n  'shuffle': 'function',\n  'sort': 'function',\n  'splice': 'function',\n  'subset': 'function',\n  'join': 'function',\n  'match': 'function',\n  'matchAll': 'function',\n  'nf': 'function',\n  'nfc': 'function',\n  'nfp': 'function',\n  'nfs': 'function',\n  'split': 'function',\n  'splitTokens': 'function',\n  'trim': 'function',\n  '_frameRate': 'number',\n  '_lastFrameTime': 'number',\n  '_targetFrameRate': 'number',\n  'print': 'function',\n  'frameCount': 'number',\n  'focused': 'boolean',\n  'cursor': 'function',\n  'frameRate': 'function',\n  'getFrameRate': 'function',\n  'setFrameRate': 'function',\n  'noCursor': 'function',\n  'displayWidth': 'number',\n  'displayHeight': 'number',\n  'windowWidth': 'number',\n  'windowHeight': 'number',\n  '_onresize': 'function',\n  'width': 'number',\n  'height': 'number',\n  'fullscreen': 'function',\n  'pixelDensity': 'function',\n  'displayDensity': 'function',\n  'getURL': 'function',\n  'getURLPath': 'function',\n  'getURLParams': 'function',\n  'createImage': 'function',\n  'saveCanvas': 'function',\n  'saveFrames': 'function',\n  '_makeFrame': 'function',\n  'loadImage': 'function',\n  'image': 'function',\n  'tint': 'function',\n  'noTint': 'function',\n  '_getTintedImageCanvas': 'function',\n  'imageMode': 'function',\n  'pixels': 'object',\n  'blend': 'function',\n  'copy': 'function',\n  'filter': 'function',\n  'get': 'function',\n  'loadPixels': 'function',\n  'set': 'function',\n  'updatePixels': 'function',\n  'loadJSON': 'function',\n  'loadStrings': 'function',\n  'loadTable': 'function',\n  'loadXML': 'function',\n  'loadBytes': 'function',\n  'httpGet': 'function',\n  'httpPost': 'function',\n  'httpDo': 'function',\n  '_pWriters': 'object',\n  'createWriter': 'function',\n  'save': 'function',\n  'saveJSON': 'function',\n  'saveJSONObject': 'function',\n  'saveJSONArray': 'function',\n  'saveStrings': 'function',\n  'saveTable': 'function',\n  'writeFile': 'function',\n  'downloadFile': 'function',\n  '_checkFileExtension': 'function',\n  '_isSafari': 'function',\n  'isKeyPressed': 'boolean',\n  'keyIsPressed': 'boolean',\n  'key': 'string',\n  'keyCode': 'number',\n  '_onkeydown': 'function',\n  '_onkeyup': 'function',\n  '_onkeypress': 'function',\n  '_onblur': 'function',\n  'keyIsDown': 'function',\n  'deviceOrientation': 'undefined',\n  'accelerationX': 'number',\n  'accelerationY': 'number',\n  'accelerationZ': 'number',\n  'pAccelerationX': 'number',\n  'pAccelerationY': 'number',\n  'pAccelerationZ': 'number',\n  '_updatePAccelerations': 'function',\n  'rotationX': 'number',\n  'rotationY': 'number',\n  'rotationZ': 'number',\n  'pRotationX': 'number',\n  'pRotationY': 'number',\n  'pRotationZ': 'number',\n  '_updatePRotations': 'function',\n  'turnAxis': 'undefined',\n  'setMoveThreshold': 'function',\n  'setShakeThreshold': 'function',\n  '_ondeviceorientation': 'function',\n  '_ondevicemotion': 'function',\n  '_handleMotion': 'function',\n  '_hasMouseInteracted': 'boolean',\n  'mouseX': 'number',\n  'mouseY': 'number',\n  'pmouseX': 'number',\n  'pmouseY': 'number',\n  'winMouseX': 'number',\n  'winMouseY': 'number',\n  'pwinMouseX': 'number',\n  'pwinMouseY': 'number',\n  'mouseButton': 'number',\n  'mouseIsPressed': 'boolean',\n  '_updateNextMouseCoords': 'function',\n  '_updateMouseCoords': 'function',\n  '_setMouseButton': 'function',\n  '_onmousemove': 'function',\n  '_onmousedown': 'function',\n  '_onmouseup': 'function',\n  '_ondragend': 'function',\n  '_ondragover': 'function',\n  '_onclick': 'function',\n  '_ondblclick': 'function',\n  '_onwheel': 'function',\n  'day': 'function',\n  'hour': 'function',\n  'minute': 'function',\n  'millis': 'function',\n  'month': 'function',\n  'second': 'function',\n  'year': 'function',\n  'touches': 'object',\n  '_updateTouchCoords': 'function',\n  '_ontouchstart': 'function',\n  '_ontouchmove': 'function',\n  '_ontouchend': 'function',\n  'createVector': 'function',\n  'abs': 'function',\n  'ceil': 'function',\n  'constrain': 'function',\n  'dist': 'function',\n  'exp': 'function',\n  'floor': 'function',\n  'lerp': 'function',\n  'log': 'function',\n  'mag': 'function',\n  'map': 'function',\n  'max': 'function',\n  'min': 'function',\n  'norm': 'function',\n  'pow': 'function',\n  'round': 'function',\n  'sq': 'function',\n  'sqrt': 'function',\n  'randomSeed': 'function',\n  'random': 'function',\n  'randomGaussian': 'function',\n  'noise': 'function',\n  'noiseDetail': 'function',\n  'noiseSeed': 'function',\n  '_angleMode': 'string',\n  'acos': 'function',\n  'asin': 'function',\n  'atan': 'function',\n  'atan2': 'function',\n  'cos': 'function',\n  'sin': 'function',\n  'tan': 'function',\n  'degrees': 'function',\n  'radians': 'function',\n  'angleMode': 'function',\n  '_toRadians': 'function',\n  '_toDegrees': 'function',\n  '_fromRadians': 'function',\n  'setAttributes': 'function',\n  '_assert3d': 'function',\n  'createCanvas': 'function',\n  'resizeCanvas': 'function',\n  'noCanvas': 'function',\n  'createGraphics': 'function',\n  'blendMode': 'function',\n  'arc': 'function',\n  'ellipse': 'function',\n  'line': 'function',\n  'point': 'function',\n  'quad': 'function',\n  'rect': 'function',\n  'triangle': 'function',\n  'ellipseMode': 'function',\n  'noSmooth': 'function',\n  'rectMode': 'function',\n  'smooth': 'function',\n  'strokeCap': 'function',\n  'strokeJoin': 'function',\n  'strokeWeight': 'function',\n  'bezier': 'function',\n  'bezierDetail': 'function',\n  'bezierPoint': 'function',\n  'bezierTangent': 'function',\n  'curve': 'function',\n  'curveDetail': 'function',\n  'curveTightness': 'function',\n  'curvePoint': 'function',\n  'curveTangent': 'function',\n  'beginContour': 'function',\n  'beginShape': 'function',\n  'bezierVertex': 'function',\n  'curveVertex': 'function',\n  'endContour': 'function',\n  'endShape': 'function',\n  'quadraticVertex': 'function',\n  'vertex': 'function',\n  'exit': 'function',\n  'noLoop': 'function',\n  'loop': 'function',\n  'push': 'function',\n  'pop': 'function',\n  'pushStyle': 'function',\n  'popStyle': 'function',\n  'redraw': 'function',\n  'size': 'function',\n  'applyMatrix': 'function',\n  'popMatrix': 'function',\n  'printMatrix': 'function',\n  'pushMatrix': 'function',\n  'resetMatrix': 'function',\n  'rotate': 'function',\n  'rotateX': 'function',\n  'rotateY': 'function',\n  'rotateZ': 'function',\n  'scale': 'function',\n  'shearX': 'function',\n  'shearY': 'function',\n  'translate': 'function',\n  'textAlign': 'function',\n  'textLeading': 'function',\n  'textSize': 'function',\n  'textStyle': 'function',\n  'textWidth': 'function',\n  'textAscent': 'function',\n  'textDescent': 'function',\n  '_updateTextMetrics': 'function',\n  'loadFont': 'function',\n  'text': 'function',\n  'textFont': 'function',\n  'createStringDict': 'function',\n  'createNumberDict': 'function',\n  'plane': 'function',\n  'box': 'function',\n  'sphere': 'function',\n  'cylinder': 'function',\n  'cone': 'function',\n  'ellipsoid': 'function',\n  'torus': 'function',\n  'loadModel': 'function',\n  'model': 'function',\n  'loadShader': 'function',\n  'createShader': 'function',\n  'shader': 'function',\n  'normalMaterial': 'function',\n  'texture': 'function',\n  'ambientMaterial': 'function',\n  'specularMaterial': 'function',\n  'ambientLight': 'function',\n  'directionalLight': 'function',\n  'pointLight': 'function',\n  // 'camera': 'function',\n  'perspective': 'function',\n  'ortho': 'function',\n  'orbitControl': 'function',\n  'select': 'function',\n  'selectAll': 'function',\n  '_wrapElement': 'function',\n  'removeElements': 'function',\n  'createDiv': 'function',\n  'createP': 'function',\n  'createSpan': 'function',\n  'createImg': 'function',\n  'createA': 'function',\n  'createSlider': 'function',\n  'createButton': 'function',\n  'createCheckbox': 'function',\n  'createSelect': 'function',\n  'createRadio': 'function',\n  'createInput': 'function',\n  'createFileInput': 'function',\n  'createVideo': 'function',\n  'createAudio': 'function',\n  'VIDEO': 'string',\n  'AUDIO': 'string',\n  'createCapture': 'function',\n  'createElement': 'function',\n  'getAudioContext': 'function',\n  'isSupported': 'function',\n  'isFileSupported': 'function',\n  'getMasterVolume': 'function',\n  'masterVolume': 'function',\n  'soundOut': 'object',\n  'sampleRate': 'function',\n  'freqToMidi': 'function',\n  'midiToFreq': 'function',\n  'soundFormats': 'function',\n  'disposeSound': 'function',\n  '_checkFileFormats': 'function',\n  '_mathChain': 'function',\n  'loadSound': 'function',\n  'createConvolver': 'function',\n  'setBPM': 'function',\n  'saveSound': 'function'\n};\n\nif (useP5JS) {\n  var isTesting = (typeof process === 'object' && process.env.TEST_RUN);\n  if (isTesting) {\n    document.hasFocus = document.hasFocus ||\n      function () {\n        return false;\n      };\n    // require('./webaudio-mocks.js');\n  }\n\n  function loadP5JS(loaded) {\n    // console.log('loadP5JS...', loaded, JSON.stringify(jsModules.p5js.loadedCallbacks, null, 2));\n    if (jsModules.p5js.loaded) {\n      loaded();\n    }\n    else if (jsModules.p5js.loadedCallbacks.length > 0) {\n      jsModules.p5js.loadedCallbacks.unshift(loaded);\n      // console.log('loadP5JS...p5js is still loading', JSON.stringify(jsModules.p5js.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.p5js.loadedCallbacks.unshift(loaded);\n      // console.log('loadP5JS...p5js initiate load', jsModules.p5js.loadedCallbacks[0]);\n\n      import(/* webpackChunkName: \"p5js\" */ 'p5JS')\n        .then(p5js => {\n          import(/* webpackChunkName: \"p5DOM\" */ 'p5/lib/addons/p5.dom.min.js')\n            .then(p5DOM => {\n              import(/* webpackChunkName: \"p5Sound\" */ 'p5/lib/addons/p5.sound.min.js')\n                .then(p5Sound => {\n                  jsModules.p5js.loaded = p5js;\n                  P5Loader = p5js.default;\n\n                  // window.p5js = p5js;\n                  window.p5 = P5Loader;\n\n/*\n                  var implicitP5VarDefs = [];\n                  // console.log('P5Loader.prototype');\n                  // for (let f in P5Loader.prototype) {\n                  //   console.log(f, typeof P5Loader.prototype[f]);\n                  for (let f in P5LoaderPrototypeInfo) {\n                    if (f.indexOf('_') !== 0) {\n                      if (P5SystemVars.indexOf(f) !== -1) {\n                        // console.log('Skipping ', f);\n                      }\n                      else {\n                        const val = P5LoaderPrototypeInfo[f];\n                        // console.log('...f', f, P5Loader[f], val);\n                        if (val === 'function') {\n                          if (f === 'loadFont') {\n                            const loadFontWrapper =\n                              `\n                              function loadFontWrapper(p5, path, callback, onError) {\n                                return p5.loadFont(path, callback, onError);\n                              }\n                              const loadFont = loadFontWrapper.bind(p5, p5);\n                              `;\n                            implicitP5VarDefs.push(loadFontWrapper);\n                          }\n                          else if (f === 'createCanvas') {\n                            const createCanvasWrapper =\n                              `\n                              function createCanvasWrapper(p5, w, h, renderer) {\n                                //console.log('in createCanvasWrapper', w, h, renderer);\n                                p5.createCanvas(w, h, renderer);\n                                width = p5.width;\n                                height = p5.height;\n                              }\n                              const createCanvas = createCanvasWrapper.bind(p5, p5);\n                              `;\n                            implicitP5VarDefs.push(createCanvasWrapper);\n                          }\n                          else {\n                            implicitP5VarDefs.push('const ' + f + ' = p5.' + f + '.bind(p5);');\n                          }\n                        }\n                        else {\n                          implicitP5VarDefs.push('const ' + f + ' = p5.' + f + ';');\n                        }\n                      }\n                    }\n                  }\n                  P5VarDefs = implicitP5VarDefs.join('\\n');\n                  console.log('P5VarDefs', P5VarDefs);\n\n                  var implicitP5SystemVarDecls = [];\n                  var implicitP5SystemVarUpdates = [];\n                  var implicitP5SystemVarDefs = [];\n                  P5SystemVars.forEach(f => {\n                    implicitP5SystemVarDecls.push(`var ${f};`);\n                    implicitP5SystemVarUpdates.push(`${f} = p5.${f};`);\n                    implicitP5SystemVarDefs.push(`const ${f} = p5.${f};`);\n                  });\n\n                  P5SystemVarDecls = implicitP5SystemVarDecls.join('\\n');\n                  P5SystemVarUpdates = implicitP5SystemVarUpdates.join('');\n                  P5SystemVarDefs = implicitP5SystemVarDefs.join('');\n\n                  var implicitP5UserFunctionDefs = [];\n                  P5UserFunctions.forEach(f => {\n                    const userFunctionSource =\n                      `if (typeof ${f} === 'function') {\n                        p5.${f} = function(p5, ${f}) {\n                          ${P5SystemVarUpdates}\n\n                          ${f}();\n                        };\n                        p5.${f} = p5.${f}.bind(this, p5, ${f});\n                      }`;\n\n                    implicitP5UserFunctionDefs.push(userFunctionSource);\n                  });\n\n                  P5UserFunctionDefs = implicitP5UserFunctionDefs.join('\\n');\n\n                  console.log('implicitP5SystemVarDecls', implicitP5SystemVarDecls);\n                  console.log('P5SystemVarDecls', P5SystemVarDecls);\n                  console.log('P5SystemVarUpdates', P5SystemVarDecls);\n                  console.log('P5SystemVarDefs', P5SystemVarDefs);\n                  console.log('P5UserFunctionDefs', P5UserFunctionDefs);\n*/\n\n                  const callThese = jsModules.p5js.loadedCallbacks;\n                  jsModules.p5js.loadedCallbacks = [];\n                  callThese.forEach(loadedCb => {\n                    loadedCb();\n                  });\n                })\n                .catch(error => {\n                  console.log('loadP5Sound error', error);\n                });\n            })\n            .catch(error => {\n              console.log('loadP5DOM error', error);\n            });\n          })\n          .catch(error => {\n            console.log('loadP5JSerror', error);\n          });\n    }\n  }\n\n  jsModules.p5js = {\n    loader: loadP5JS,\n    loaded: null,\n    loadedCallbacks: []\n  };\n\n  var implicitP5VarDefs = [];\n  // console.log('P5Loader.prototype');\n  // for (let f in P5Loader.prototype) {\n  //   console.log(f, typeof P5Loader.prototype[f]);\n  for (let f in P5LoaderPrototypeInfo) {\n    if (f.indexOf('_') !== 0) {\n      if (P5SystemVars.indexOf(f) !== -1) {\n        // console.log('Skipping ', f);\n      }\n      else {\n        const val = P5LoaderPrototypeInfo[f];\n        // console.log('...f', f, P5Loader[f], val);\n        if (val === 'function') {\n          if (f === 'loadFont') {\n            const loadFontWrapper =\n              `\n              function loadFontWrapper(p5, path, callback, onError) {\n                return p5.loadFont(path, callback, onError);\n              }\n              const loadFont = loadFontWrapper.bind(p5, p5);\n              `;\n            implicitP5VarDefs.push(loadFontWrapper);\n          }\n          else if (f === 'createCanvas') {\n            const createCanvasWrapper =\n              `\n              function createCanvasWrapper(p5, w, h, renderer) {\n                //console.log('in createCanvasWrapper', w, h, renderer);\n                p5.createCanvas(w, h, renderer);\n                width = p5.width;\n                height = p5.height;\n              }\n              const createCanvas = createCanvasWrapper.bind(p5, p5);\n              `;\n            implicitP5VarDefs.push(createCanvasWrapper);\n          }\n          else {\n            // implicitP5VarDefs.push(`console.log('p5.${f}', p5.${f}, typeof p5.${f});const ${f} = p5.${f}.bind(p5);`);\n            implicitP5VarDefs.push(`const ${f} = p5.${f}.bind(p5);`);\n          }\n        }\n        else {\n          implicitP5VarDefs.push('const ' + f + ' = p5.' + f + ';');\n        }\n      }\n    }\n  }\n  P5VarDefs = implicitP5VarDefs.join('\\n');\n\n  var implicitP5SystemVarDecls = [];\n  var implicitP5SystemVarUpdates = [];\n  var implicitP5SystemVarDefs = [];\n  P5SystemVars.forEach(f => {\n    implicitP5SystemVarDecls.push(`var ${f};`);\n    implicitP5SystemVarUpdates.push(`${f} = p5.${f};`);\n    implicitP5SystemVarDefs.push(`const ${f} = p5.${f};`);\n  });\n\n  P5SystemVarDecls = implicitP5SystemVarDecls.join('\\n');\n  P5SystemVarUpdates = implicitP5SystemVarUpdates.join('');\n  P5SystemVarDefs = implicitP5SystemVarDefs.join('');\n\n  var implicitP5UserFunctionDefs = [];\n  P5UserFunctions.forEach(f => {\n    const userFunctionSource =\n      `if (typeof ${f} === 'function') {\n        p5.${f} = function(p5, ${f}) {\n          ${P5SystemVarUpdates}\n\n          ${f}();\n        };\n        p5.${f} = p5.${f}.bind(this, p5, ${f});\n      }`;\n\n    implicitP5UserFunctionDefs.push(userFunctionSource);\n  });\n\n  P5UserFunctionDefs = implicitP5UserFunctionDefs.join('\\n');\n\n  // console.log('implicitP5SystemVarDecls', implicitP5SystemVarDecls);\n  // console.log('P5SystemVarDecls', P5SystemVarDecls);\n  // console.log('P5SystemVarUpdates', P5SystemVarDecls);\n  // console.log('P5SystemVarDefs', P5SystemVarDefs);\n  // console.log('P5UserFunctionDefs', P5UserFunctionDefs);\n}\n\n\nvar Three = {};\nif (useThree) {\n  function loadThree(loaded) {\n    // console.log('loadThree...', loaded, JSON.stringify(jsModules.three.loadedCallbacks, null, 2));\n    if (jsModules.three.loaded) {\n      loaded();\n    }\n    else if (jsModules.three.loadedCallbacks.length > 0) {\n      jsModules.three.loadedCallbacks.unshift(loaded);\n      // console.log('loadthree...three is still loading', JSON.stringify(jsModules.three.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.three.loadedCallbacks.unshift(loaded);\n      // console.log('loadthree...three initiate load', jsModules.three.loadedCallbacks[0]);\n      import(/* webpackChunkName: \"three\" */ 'three')\n        .then(three => {\n          // console.log('loadthree...import success', three, jsModules.three.loadedCallbacks[0]);\n          jsModules.three.loaded = three;\n          const threePackage = three;\n          Object.keys(threePackage).forEach(slot => {\n            // console.log('...slot', slot, threePackage[slot]);\n            Three[slot] = threePackage[slot];\n          });\n\n          const callThese = jsModules.three.loadedCallbacks;\n          jsModules.three.loadedCallbacks = [];\n          callThese.forEach(loadedCb => {\n            loadedCb();\n          });\n        })\n        .catch(error => {\n          console.log('loadthree error', error);\n        });\n    }\n  }\n\n  jsModules.three = {\n    loader: loadThree,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\nvar LDF = {};\nif (useLDF) {\n  function loadLDF(loaded) {\n    // console.log('loadLDF...', loaded, JSON.stringify(jsModules.ldf.loadedCallbacks, null, 2));\n    if (jsModules.ldf.loaded) {\n      loaded();\n    }\n    else if (jsModules.ldf.loadedCallbacks.length > 0) {\n      jsModules.ldf.loadedCallbacks.unshift(loaded);\n      // console.log('loadldf...ldf is still loading', JSON.stringify(jsModules.ldf.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.ldf.loadedCallbacks.unshift(loaded);\n      // console.log('loadldf...ldf initiate load', jsModules.ldf.loadedCallbacks[0]);\n      import(/* webpackChunkName: \"ldf\" */ 'ldfJS')\n        .then(ldf => {\n          // console.log('loadldf...import success', ldf, jsModules.ldf.loadedCallbacks[0]);\n          jsModules.ldf.loaded = ldf;\n          const ldfPackage = ldf;\n          Object.keys(ldfPackage).forEach(slot => {\n            // console.log('...slot', slot, ldfPackage[slot]);\n            LDF[slot] = ldfPackage[slot];\n          });\n\n          const callThese = jsModules.ldf.loadedCallbacks;\n          jsModules.ldf.loadedCallbacks = [];\n          callThese.forEach(loadedCb => {\n            loadedCb();\n          });\n        })\n        .catch(error => {\n          console.log('loadldf error', error);\n        });\n    }\n  }\n\n  jsModules.ldf = {\n    loader: loadLDF,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\n\n\nvar Brython;\nif (useBrython) {\n  function loadBrython(loaded) {\n    // console.log('loadBrython...', loaded, JSON.stringify(jsModules.brython.loadedCallbacks, null, 2));\n    if (jsModules.brython.loaded) {\n      loaded();\n    }\n    else if (jsModules.brython.loadedCallbacks.length > 0) {\n      jsModules.brython.loadedCallbacks.unshift(loaded);\n      // console.log('loadbrython...brython is still loading', JSON.stringify(jsModules.brython.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.brython.loadedCallbacks.unshift(loaded);\n      const debugging = false;\n      if (debugging) {\n        const callThese = jsModules.brython.loadedCallbacks;\n        jsModules.brython.loadedCallbacks = [];\n        callThese.forEach(loadedCb => {\n          loadedCb();\n        });\n      }\n      else {\n        importScriptUrl(\n          // 'https://cdn.rawgit.com/brython-dev/brython/3.6.2/www/src/brython.js',\n          baseURL + 'lib/brython.js',\n          function(script1) {\n            importScriptUrl(\n              // 'https://cdn.rawgit.com/brython-dev/brython/3.6.2/www/src/brython_stdlib.js',\n              baseURL + 'lib/brython_stdlib.js',\n              function(script2) {\n                Brython = window.brython;\n                jsModules.brython.loaded = Brython;\n                const callThese = jsModules.brython.loadedCallbacks;\n                jsModules.brython.loadedCallbacks = [];\n                callThese.forEach(loadedCb => {\n                  loadedCb();\n                });\n            });\n        });\n      }\n    }\n  }\n\n  jsModules.brython = {\n    loader: loadBrython,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\nfunction mathjaxConfigure() {\n  // https://github.com/mathjax/MathJax/blob/master/config/default.js\n  MathJax.Hub.Config({\n    \"fast-preview\": {\n      disabled:true\n    },\n    TeX: {\n      MultLineWidth: '85%',\n      equationNumbers: {\n        autoNumber: 'none'\n      },\n      extensions: [\n        'AMSmath.js',\n        'AMSsymbols.js',\n        'noErrors.js',\n        'noUndefined.js',\n        'autobold.js',\n        'AMScd.js',\n        'mhchem.js',\n        'action.js',\n        'extpfeil.js',\n        window.xypicURL\n      ]\n    },\n\n    tex2jax: {\n      inlineMath: [ ['$', '$'], ['\\\\(', '\\\\)'] ],\n      displayMath: [ ['$$', '$$'], ['\\\\[', '\\\\]'] ],\n      processEscapes: true,\n      skipTags: ['script','noscript','style','textarea','pre','code','annotation','annotation-xml']\n    },\n\n    asciimath2jax: {\n      delimiters: [['@', '@']]\n    },\n\n    // Custom config\n    skipStartupTypeset: true,\n    // showProcessingMessages: false,\n    // messageStyle: 'none',\n    displayAlign: 'center',\n    // processSectionDelay: 0,\n    positionToHash: false,\n    // showMathMenu: false,\n    // showMathMenuMSIE: false,\n  });\n\n  MathJax.Hub.Register.MessageHook(\"Math Processing Error\", function (message) {\n    console.log('Math Processing Error', message, MathJax.Hub.lastError);\n  });\n}\n\nvar Plotly = {};\nif (usePlotly) {\n  function loadPlotly(loaded) {\n    // console.log('loadPlotly...', jsModules.plotly.loadedCallbacks.length, loaded, JSON.stringify(jsModules.plotly.loadedCallbacks, null, 2));\n    if (jsModules.plotly.loaded) {\n      loaded();\n    }\n    else if (jsModules.plotly.loadedCallbacks.length > 0) {\n      jsModules.plotly.loadedCallbacks.unshift(loaded);\n      // console.log('loadplotly...plotly is still loading', JSON.stringify(jsModules.plotly.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.plotly.loadedCallbacks.unshift(loaded);\n\n      importScriptUrl(\n        'https://cdn.plot.ly/plotly-latest.min.js',\n        function(script) {\n          /* global Plotly */\n\n          const plotlyPackage = window.Plotly;\n          Object.keys(plotlyPackage).forEach(slot => {\n            // console.log('...slot', slot, plotlyPackage[slot]);\n            Plotly[slot] = plotlyPackage[slot];\n          });\n\n          // console.log('loaded Plotly', plotlyPackage, window, Plotly);\n          if (window.d3v5) {\n            var d3sankey = require('d3-sankey');\n            window.d3v5.sankey = d3sankey.sankey;\n          }\n\n          // Undo any ill effects from Plotly's MathJax config.\n          mathjaxConfigure();\n          const callThese = jsModules.plotly.loadedCallbacks;\n          jsModules.plotly.loadedCallbacks = [];\n          callThese.forEach(loadedCb => {\n            loadedCb();\n          });\n        });\n    }\n  }\n\n  jsModules.plotly = {\n    loader: loadPlotly,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\n\nvar D3 = {};\nif (useD3) {\n  function loadD3(loaded) {\n    // console.log('loadD3...', loaded, JSON.stringify(jsModules.d3.loadedCallbacks, null, 2));\n    if (jsModules.d3.loaded) {\n      loaded();\n    }\n    else if (jsModules.d3.loadedCallbacks.length > 0) {\n      jsModules.d3.loadedCallbacks.unshift(loaded);\n      // console.log('loadD3...D3 is still loading', JSON.stringify(jsModules.d3.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.d3.loadedCallbacks.unshift(loaded);\n\n      // console.log('loadD3...D3 initiate load');\n      import(/* webpackChunkName: \"d3\" */ 'd3JS')\n        .then(d3 => {\n          // console.log('loadD3...import success', d3);\n          jsModules.d3.loaded = d3;\n          window.d3v5 = window.d3 = d3;\n          window.smartdown.d3v5 = window.d3v5;\n\n          import(/* webpackChunkName: \"d3cloudJS\" */ 'd3cloudJS')\n            .then(d3cloud => {\n              // console.log('loadD3 d3cloud...import success', d3cloud);\n              window.d3cloud = d3cloud.default;\n              window.smartdown.d3cloud = window.d3cloud;\n\n              import(/* webpackChunkName: \"topojson\" */ 'topojson')\n                .then(topojson => {\n                  // console.log('loadD3 topojson...import success', topojson);\n                  window.topojson = topojson;\n                  window.smartdown.topojson = window.topojson;\n\n                  const wcl = baseURL + 'lib/webcomponents-loader.js';\n                  console.log('wcl', wcl);\n                  importScriptUrl(\n                    wcl,\n                    function(script1) {\n                      import(/* webpackChunkName: \"d3fc\" */ 'd3fcJS')\n                        .then(d3fc => {\n                          // console.log('loadD3 d3fc...import success', d3fc);\n                          window.d3fc = d3fc;\n                          window.smartdown.d3fc = window.d3fc;\n\n                          import(/* webpackChunkName: \"d3dc\" */ 'd3dcJS')\n                            .then(d3dc => {\n                              // console.log('loadD3 d3fc...import success', d3dc);\n                              window.d3dc = d3dc;\n                              window.smartdown.d3dc = window.d3dc;\n                              window.d3dc.config.defaultColors(window.d3v5.schemeAccent);\n\n                              import(/* webpackChunkName: \"d3dcCSS\" */ 'd3dcCSS')\n                                .then(d3dcCSS => {\n                                  // console.log('loadD3 d3dcCSS...import success', d3dcCSS);\n\n                                  const callThese = jsModules.d3.loadedCallbacks;\n                                  jsModules.d3.loadedCallbacks = [];\n                                  callThese.forEach(loadedCb => {\n                                    loadedCb();\n                                  });\n                                })\n                                .catch(error => {\n                                  console.log('loadD3 d3dcCSS error', error);\n                                });\n                            })\n                            .catch(error => {\n                              console.log('loadD3 d3dc error', error);\n                            });\n                        })\n                        .catch(error => {\n                          console.log('loadD3 d3fc error', error);\n                        });\n                    });\n                })\n                .catch(error => {\n                  console.log('loadD3 topojson error', error);\n                });\n            })\n            .catch(error => {\n              console.log('loadD3 d3cloud error', error);\n            });\n\n        })\n        .catch(error => {\n          console.log('loadD3 error', error);\n        });\n    }\n  }\n\n  jsModules.d3 = {\n    loader: loadD3,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\n\nvar Viz;\nif (useGraphviz) {\n  function loadGraphviz(loaded) {\n    // console.log('loadGraphviz...', loaded, JSON.stringify(jsModules.graphviz.loadedCallbacks, null, 2));\n    if (jsModules.graphviz.loaded) {\n      loaded();\n    }\n    else if (jsModules.graphviz.loadedCallbacks.length > 0) {\n      jsModules.graphviz.loadedCallbacks.unshift(loaded);\n      // console.log('loadgraphviz...graphviz is still loading', JSON.stringify(jsModules.graphviz.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.graphviz.loadedCallbacks.unshift(loaded);\n      importScriptUrl(\n        baseURL + 'lib/viz.js',\n        function(script1) {\n          importScriptUrl(\n            baseURL + 'lib/lite.render.js',\n            function(script2) {\n              Viz = window.Viz;\n              registerMediaWithGraphviz();\n              const callThese = jsModules.graphviz.loadedCallbacks;\n              jsModules.graphviz.loadedCallbacks = [];\n              callThese.forEach(loadedCb => {\n                loadedCb();\n              });\n          });\n      });\n    }\n  }\n\n  jsModules.graphviz = {\n    loader: loadGraphviz,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\nvar mermaid = null;\nvar mermaidAPI = null;\nfunction fixupMermaidSVG(svgCode) {\n  svgCode = svgCode.replace(/\\n/g, '');\n  var beginStyleTag = '<style>';\n  var endStyleTag = '</style>';\n\n  var beginStyle = svgCode.indexOf(beginStyleTag);\n  var endStyle = svgCode.indexOf(endStyleTag);\n  var svgStyle = svgCode.slice(beginStyle + beginStyleTag.length, endStyle).trim();\n  var svgStyleLines = svgStyle.split(/}/g);\n  --svgStyleLines.length; // Assumes last element is ''\n  var svgNewStyleLines = svgStyleLines.map(function (line) {\n    var bracePos = line.indexOf('{');\n    var selectors = line.slice(0, bracePos);\n    var body = line.slice(bracePos);\n    var selectorsNew = selectors.replace(/,/g, ',.mermaid ');\n    selectorsNew = '.mermaid ' + selectorsNew;\n    selectorsNew = selectorsNew.replace(/.mermaid .mermaid/g, '.mermaid');\n\n    var newLine = selectorsNew + body;\n    return newLine;\n  });\n  var svgNewStyle = beginStyleTag + svgNewStyleLines.join('}') + endStyleTag;\n  svgCode =   svgCode.slice(0, beginStyle) +\n              svgNewStyle +\n              svgCode.slice(endStyle + endStyleTag.length);\n  return svgCode;\n}\n\n\nfunction mermaidRender(div, code) {\n  if (mermaid) {\n    div.classList.add('mermaid');\n    mermaid.render(\n      div.id + '_svg',\n      code,\n      function (svgCode) {\n        var svgCodeNew = fixupMermaidSVG(svgCode);\n        div.innerHTML = svgCodeNew;\n      },\n      div\n    );\n  }\n  else {\n    div.innerHTML = 'mermaidjs not loaded';\n  }\n}\n\nif (useMermaid) {\n  function initializeMermaid() {\n    mermaid = window.mermaid;\n    mermaidAPI = mermaid;\n\n    var config = {\n      startOnLoad: false,\n      cloneCssStyles: false,\n      logLevel: 3,\n      // theme: 'dark',\n      // logLevel , decides the amount of logging to be used.\n      //    * debug: 1\n      //    * info: 2\n      //    * warn: 3\n      //    * error: 4\n      //    * fatal: 5\n\n      htmlLabels: true,\n      fontSize: 16,\n      flowchart: {\n        htmlLabels: true,\n        useMaxWidth: false,\n      },\n      sequenceDiagram: {\n        diagramMarginX: 50,\n        diagramMarginY: 20,\n        actorMargin: 40,\n        width: 120,\n        height: 40,\n        boxMargin: 20,\n        boxTextMargin: 5,\n        noteMargin: 5,\n        messageMargin: 55,\n        mirrorActors: false,\n        bottomMarginAdj: 0,\n        useMaxWidth: false,\n      },\n      ganttchart: {\n        titleTopMargin: 15,\n        diagramMarginX: 10,\n        diagramMarginY: 10,\n        barHeight: 20,\n        barGap: 4,\n        topPadding: 50,\n        sidePadding: 75,\n        gridLineStartPadding: 35,\n        fontSize: 16,\n        numberSectionStyles: 3,\n        useMaxWidth: false,\n        // axisFormatter: [\n        //   // Within a day\n        //   ['%I:%M', function (d) {\n        //     return d.getHours();\n        //   }],\n        //   // Monday a week\n        //   ['w. %U', function (d) {\n        //     return d.getDay() === 1;\n        //   }],\n        //   // Day within a week (not monday)\n        //   ['%a %d', function (d) {\n        //     return d.getDay() && d.getDate() !== 1;\n        //   }],\n        //   // within a month\n        //   ['%b %d', function (d) {\n        //     return d.getDate() !== 1;\n        //   }],\n        //   // Month\n        //   ['%m-%y', function (d) {\n        //     return d.getMonth();\n        //   }]\n        // ]\n      }\n    };\n\n    mermaidAPI.initialize(config);\n  }\n\n  function loadMermaid(loaded) {\n    // console.log('loadMermaid...', jsModules.mermaid.loadedCallbacks.length, loaded, JSON.stringify(jsModules.mermaid.loadedCallbacks, null, 2));\n    if (jsModules.mermaid.loaded) {\n      loaded();\n    }\n    else if (jsModules.mermaid.loadedCallbacks.length > 0) {\n      jsModules.mermaid.loadedCallbacks.unshift(loaded);\n      // console.log('loadmermaid...mermaid is still loading', JSON.stringify(jsModules.mermaid.loadedCallbacks, null, 2));\n    }\n    else {\n      jsModules.mermaid.loadedCallbacks.unshift(loaded);\n\n      const url = 'https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js';\n      importScriptUrl(\n        url,\n        function(script) {\n          /* global Mermaid */\n\n          // mermaid = window.mermaid;\n          // console.log('mermaidPackage', mermaidPackage);\n          // Object.keys(mermaidPackage).forEach(slot => {\n          //   // console.log('...slot', slot, mermaidPackage[slot]);\n          //   Mermaid[slot] = mermaidPackage[slot];\n          // });\n\n          initializeMermaid();\n\n          const callThese = jsModules.mermaid.loadedCallbacks;\n          jsModules.mermaid.loadedCallbacks = [];\n          callThese.forEach(loadedCb => {\n            loadedCb();\n          });\n        });\n    }\n  }\n\n  jsModules.mermaid = {\n    loader: loadMermaid,\n    loaded: null,\n    loadedCallbacks: []\n  };\n}\n\n\nconst playableArgNames = [\n  'playable',\n  'env',\n  'P5',\n  'd3',\n  'fc',\n  'dc',\n  'topojson',\n  'Plotly',\n  'L',\n  'stdlib',\n  'THREE',\n  'smartdown',\n  'p5'\n];\n\nrequire('highlight.js/styles/default.css');\nrequire('./styles.css');\n\n// if (useD3) {\n//   window.d3v5 = require('d3JS');\n//   require('@webcomponents/webcomponentsjs/webcomponents-bundle');\n//   window.d3fc = require('d3fcJS');\n//   window.d3dc = require('d3dcJS');\n//   window.d3dc.config.defaultColors(window.d3v5.schemeAccent);\n//   require('d3dcCSS');\n//   window.d3cloud = require('d3cloudJS');\n//   window.topojson = require('topojson');\n// }\n\nvar Leaflet = {};\nif (useLeaflet) {\n  /* global L */\n  Leaflet = require('leafletJS');\n  require('leaflet/dist/leaflet.css');\n\n  delete Leaflet.Icon.Default.prototype._getIconUrl;\n\n  L.Icon.Default.mergeOptions({\n    iconRetinaUrl: 'marker-icon-2x.png',\n    iconUrl: 'marker-icon.png',\n    shadowUrl: 'marker-shadow.png',\n  });\n}\n\n\nimport Gifffer from 'gifffer';\nimport hljs from 'highlight.js/lib/highlight';\n\nglobal.hljs = hljs;\nwindow.hljs = hljs;\n\nhljs.registerLanguage('bash', require('highlight.js/lib/languages/bash'));\nhljs.registerLanguage('css', require('highlight.js/lib/languages/css'));\nhljs.registerLanguage('markdown', require('highlight.js/lib/languages/markdown'));\nhljs.registerLanguage('ruby', require('highlight.js/lib/languages/ruby'));\nhljs.registerLanguage('javascript', require('highlight.js/lib/languages/javascript'));\nhljs.registerLanguage('json', require('highlight.js/lib/languages/json'));\nhljs.registerLanguage('php', require('highlight.js/lib/languages/php'));\nhljs.registerLanguage('processing', require('highlight.js/lib/languages/processing'));\nhljs.registerLanguage('python', require('highlight.js/lib/languages/python'));\nhljs.registerLanguage('r', require('highlight.js/lib/languages/r'));\nhljs.registerLanguage('sql', require('highlight.js/lib/languages/sql'));\nhljs.registerLanguage('yaml', require('highlight.js/lib/languages/yaml'));\n\n\nvar baseURL = null;\nvar cardLoader = null;\nvar calcHandlers = null;\nvar linkRules = [];\nvar currentHomeDiv = null;\nvar currentMD = null;\nvar playableTypes = {\n  'brython': {\n    highlight: 'python',\n    javascript: true\n  },\n  'go': {\n    highlight: 'go',\n    transform: 'gopherjs',\n    javascript: true\n  },\n  'javascript': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'd3': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'leaflet': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'plotly': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'stdlib': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'three': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'p5js': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'P5JS': {\n    highlight: 'javascript',\n    javascript: true\n  },\n  'smartdown': {\n    highlight: 'markdown',\n    javascript: false\n  },\n  'graphviz': {\n    highlight: 'graphviz',\n    javascript: false\n  },\n  'mermaid': {\n    highlight: 'mermaid',\n    javascript: false\n  }\n};\n\n\nvar perPageState = {\n  expressionsRegistered: {},\n  playablesRegistered: {},\n  playablesRegisteredOrder: [],\n};\nvar currentRenderDiv = null;\nvar currentBackpatches = {};\n\nvar cellIndex = 0;\nvar smartdownCells = {};\n\nvar cardLoading = false;\n\nvar smartdownVariables = {};\nvar smartdownScripts = [];\nvar smartdownScriptsMap = {};\n\nvar mediaRegistry = {};\nvar scriptIndex = 0;\n\nvar markedModule = require('marked');\n\n\nfunction escapeQuotes(s) {\n  return s.replace(/'/g, '\\\\\\'')\n          .replace(/\"/g, '\\\\\\\"');\n}\n\nfunction escapeSingle(s) {\n  return s.replace(/'/g, '\\\\\\'');\n}\n\nfunction entityEscape(html, encode) {\n  return html\n    .replace(!encode ? /&(?!#?\\w+;)/g : /&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\n/* global escape */\n\nconst globalescape = escape || function(s) {return `noglobalescape(${s})`;};\nconst windowescape = window.escape;\nconst escape = entityEscape;\n\nvar markedOpts = {\n  renderer: 'crashNoRenderer',\n  gfm: true,\n  tables: true,\n  breaks: true,\n  gfmBreaks: true,\n  pedantic: false,\n  sanitize: true,\n  smartLists: true,\n  smartypants: false,\n  highlight: function (code, lang) {    // , callback)\n    var playableType = playableTypes[lang];\n    var result;\n    if (lang && playableType) {\n      var mappedLanguage = playableType ? playableType.highlight : lang;\n      result = hljs.highlightAuto(code, [mappedLanguage]);\n    }\n    else {\n      result = hljs.highlightAuto(code, [lang]);\n    }\n\n    return result.value;\n  }\n};\n\n\nfunction expandHrefWithLinkRules(href) {\n  var result = href;\n\n  for (var i = 0; i < linkRules.length; ++i) {\n    const rule = linkRules[i];\n    if (href.indexOf(rule.prefix) === 0) {\n      if ((typeof rule.replace) === 'string') {\n        var newHRef = rule.replace + href.slice(rule.prefix.length);\n        if (newHRef.indexOf(window.location.origin) === 0) {\n          newHRef = newHRef.slice(window.location.origin.length);\n        }\n        result = newHRef;\n        break;\n      }\n      else if ((typeof rule.replace) === 'function') {\n        var replacer = rule.replace(href);\n        result = replacer + href.slice(rule.prefix.length);\n      }\n    }\n  }\n\n  // console.log('expandHrefWithLinkRules', linkRules, href, result, JSON.stringify(window.location, null, 2));\n\n  return result;\n}\n\n\n// https://github.com/mdaines/viz.js/wiki/API#render-options\n\nvar graphvizImages = null;\nfunction registerMediaWithGraphviz() {\n  graphvizImages = [];\n\n  each(mediaRegistry, function (data, _key) {\n    //     graphvizFiles.push({\n    //       path: data.url,\n    //       data:\n    // `\n    // <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n    // <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n    // <svg height=\"100\" width=\"100\">\n    //   <circle cx=\"50\" cy=\"50\" r=\"40\" stroke=\"black\" stroke-width=\"3\" fill=\"red\" />\n    //   Sorry, your browser does not support inline SVG.\n    // </svg>\n    // `\n    //     });\n    // console.log('registerMediaWithGraphviz', key, data.url);\n    graphvizImages.push({\n      path: data.url,\n      width: '200px',\n      height: '200px'\n    });\n  });\n  window.graphvizImages = graphvizImages;\n}\n\n// Copied from https://github.com/jashkenas/underscore/blob/e944e0275abb3e1f366417ba8facb5754a7ad273/underscore.js#L1458\n\nvar unescapeMap = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#x27;': \"'\",\n  '&#39;': \"'\",\n  '&#x60;': '`'\n};\n\n// Functions for escaping and unescaping strings to/from HTML interpolation.\nvar createEscaper = function (map) {\n  var escaper = function (match) {\n    return map[match];\n  };\n  // Regexes for identifying a key that needs to be escaped.\n  var source = '(?:' + Object.keys(map).join('|') + ')';\n  var testRegexp = RegExp(source);\n  var replaceRegexp = RegExp(source, 'g');\n  return function (string) {\n    string = string == null ? '' : '' + string;\n    return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;\n  };\n};\nvar decodeInlineScript = createEscaper(unescapeMap);\n\n\nfunction getServiceOrigin() {\n  var result = window.location.origin;\n  if (window.location.protocol === 'file:') {\n    result = 'http://127.0.0.1:3000';\n  }\n\n  return result;\n}\n\n\n\nconst youtubeDimensions = {\n  thumbnail: 'width=\"426\" height=\"240\"',\n  halfwidth: 'width=\"640\" height=\"360\"',\n  fullwidth: 'width=\"1280\" height=\"720\"',\n};\nconst youtubeClasses = {\n  thumbnail: 'thumbnail',\n  halfwidth: 'halfwidth',\n  fullwidth: 'fullwidth',\n};\n\nvar uniqueYouTubeId = 0;\n\nfunction convertYoutubeFragmentToEmbed(href, title) {\n  // console.log('convertYoutubeFragmentToEmbed', href, title);\n  var result = null;\n  var titleParts = title.split('|');\n  title = titleParts[0];\n  var shortPrefixes = ['http://youtu.be/', 'https://youtu.be/'];\n  var longPrefixes = ['http://www.youtube.com/watch?v=', 'https://www.youtube.com/watch?v='];\n\n  const sizing = youtubeDimensions[title] || '';\n  const classList = youtubeClasses[title] || '';\n\n  shortPrefixes.every(prefix => {\n    if (href.indexOf(prefix) === 0) {\n      var suffix = href.substr(prefix.length);\n      ++uniqueYouTubeId;\n\n      let enablejsapi = '';\n      let apiButton = '';\n      let apiPlayerKey = `player_${uniqueYouTubeId}`;\n      if (titleParts.length > 1) {\n        const apiParts = titleParts[1].split('=');\n        if (apiParts[0] === 'api') {\n          if (apiParts.length > 1) {\n            apiPlayerKey = apiParts[1];\n          }\n          enablejsapi = '&enablejsapi=1';\n          apiButton =\n            `\n            <button\n              type=\"button\"\n              id=\"youtube-api-${uniqueYouTubeId}\"\n              href=\"#\"\n              onclick=\"smartdown.setupYouTubePlayer('youtube-iframe-${uniqueYouTubeId}', '${apiPlayerKey}')\"\n              class=\"api-button\">\n              Enable API for player <b>${apiPlayerKey}</b>\n            </button>\n            `;\n        }\n      }\n\n      result =\n        `<div class=\"video-container youtube ${classList}\">\n          <iframe\n            id=\"youtube-iframe-${uniqueYouTubeId}\"\n            ${sizing}\n            src=\"https://www.youtube.com/embed/${suffix}?html5=1&ecver=2&modestbranding=1${enablejsapi}\"\n            frameborder=\"0\"\n\n            allowfullscreen>\n          </iframe>\n        </div>\n        ${apiButton}\n        `;\n\n      // console.log(result);\n\n      return false;\n    }\n    else {\n      return true;\n    }\n  });\n\n  if (!result) {\n    longPrefixes.every(prefix => {\n      if (href.indexOf(prefix) === 0) {\n        var suffix = href.substr(prefix.length);\n        result =\n`<div\n  class=\"video-container youtube ${classList}\">\n  <iframe\n    ${sizing}\n    src=\"https://www.youtube.com/embed/${suffix}\"\n    frameborder=\"0\"\n    allowfullscreen>\n  </iframe>\n</div>\n`;\n        return false;\n      }\n      else {\n        return true;\n      }\n    });\n  }\n\n  return result;\n}\n\n\nfunction convertVimeoFragmentToEmbed(href, title) {\n  var result = null;\n  var shortPrefixes = ['http://vimeo.com/', 'https://vimeo.com/'];\n  var classList = (title === 'thumbnail') ? 'thumbnail' : 'fullwidth';\n\n  shortPrefixes.every(prefix => {\n    if (href.indexOf(prefix) === 0) {\n      var suffix = href.substr(prefix.length);\n      var opts = '?title=0&byline=0&portrait=0&badge=0';\n\n      result =\n`<div class=\"video-container vimeo ${classList}\">\n  <iframe\n    src=\"https://player.vimeo.com/video/${suffix}${opts}\"\n    width=\"640\"\n    height=\"360\"\n    frameborder=\"0\"\n    webkitallowfullscreen\n    mozallowfullscreen\n    allowfullscreen>\n  </iframe>\n</div>\n`;\n\n      return false;\n    }\n    else {\n      return true;\n    }\n  });\n\n  return result;\n}\n\n\nfunction areValuesSameEnough(oldValue, newValue) {\n  const result = JSON.stringify(oldValue) === JSON.stringify(newValue);\n\n  //  let result = oldValue === newValue;\n  //\n  //  if ((typeof oldValue === 'number') && isNaN(oldValue) &&\n  //      (typeof newValue === 'number') && isNaN(newValue)) {\n  //    result = true;\n  //  }\n  //\n  //  if (!result) {\n  //    console.log('areValuesSameEnough', oldValue, newValue, typeof oldValue, typeof newValue);\n  //  }\n\n  return result;\n}\n\n\n//\n// Marked rendering extensions\n//\n\n\nfunction recursivelyLoadIncludes(prefixCode, language, includesRemaining, done) {\n  if (includesRemaining.length > 0) {\n    const nextInclude = includesRemaining.shift();\n    // console.log('nextInclude', nextInclude);\n\n    importTextUrl(\n      nextInclude,\n      function (nextIncludeText) {\n        // console.log('recursivelyLoadIncludes success', nextInclude, nextIncludeText.slice(0, 50));\n\n        recursivelyLoadIncludes(\n          prefixCode + nextIncludeText,\n          language,\n          includesRemaining,\n          done);\n      },\n      function (error) {\n        console.log('recursivelyLoadIncludes error', nextInclude, error);\n\n        const errorText =\n`\n//\n// Unable to include ${nextInclude}: ${error}\n//\n`;\n        recursivelyLoadIncludes(\n          prefixCode + errorText,\n          language,\n          includesRemaining,\n          done);\n      }\n    );\n  }\n  else if (done) {\n    done(prefixCode);\n  }\n}\n\n\nfunction getPrelude(language, code) {\n  const playableType = playableTypes[language];\n  const imports = [];\n  const includes = [];\n\n  const loadableLanguages = [\n    'd3',\n    'brython',\n    'stdlib',\n    'p5js',\n    'P5JS',\n    'three',\n    'ldf',\n    'plotly',\n    'graphviz',\n    'mermaid',\n  ];\n\n  if (loadableLanguages.indexOf(language) >= 0) {\n    imports.push(language);\n  }\n\n  if (playableTypes.javascript) {\n    const lines = code.split('\\n');\n    const usePrefix = '//smartdown.import=';\n    const includePrefix = '//smartdown.include=';\n    lines.forEach(line => {\n      if (line.indexOf(usePrefix) === 0) {\n        const rhs = line.slice(usePrefix.length);\n        imports.push(rhs);\n      }\n      else if (line.indexOf(includePrefix) === 0) {\n        const rhs = line.slice(includePrefix.length);\n        includes.push(rhs);\n      }\n    });\n  }\n\n  // console.log('getPrelude', language, imports);\n\n  return {\n    imports: imports,\n    includes: includes\n  };\n}\n\nfunction renderCodeInternal(renderDivId, code, language, prelude) {\n  language = language || '';\n  var languageElements = language.split('/');\n  var languageOpts = languageElements.slice(1);\n  var playable = languageOpts.indexOf('playable') >= 0;\n  var autoplay = languageOpts.indexOf('autoplay') >= 0;\n  var debug = languageOpts.indexOf('debug') >= 0;\n\n  language = languageElements[0];\n\n  var playableType = playableTypes[language];\n  if (playableType && (playable || autoplay)) {\n    // console.log('renderCodeInternal', renderDivId, code, language, languageOpts, prelude);\n\n    ++scriptIndex;\n    var scriptId = `script_playable_${scriptIndex}`;\n    var divId = `div_playable_${scriptIndex}`;\n    var preId = `pre_playable_${scriptIndex}`;\n    var dbgId = `dbg_playable_${scriptIndex}`;\n    var dbgToggleId = `${dbgId}-toggle`;\n    var functionId = `function_playable_${scriptIndex}`;\n    var playId = `play_playable_${scriptIndex}`;\n    var stopId = `stop_playable_${scriptIndex}`;\n    var progressId = `progress_playable_${scriptIndex}`;\n    var registeredPlayable = smartdown.registerPlayable(\n      prelude,\n      language,\n      renderDivId,\n      divId,\n      preId,\n      dbgId,\n      scriptId,\n      functionId,\n      playId,\n      stopId,\n      dbgToggleId,\n      progressId,\n      autoplay,\n      code,\n      playableType.transform\n    );\n\n    var playableScript = '';\n\n    if (playableType.javascript) {\n      var transformedCode = registeredPlayable.augmentedCode;\n//       if (language === 'go' && playableType.transform) {\n//         transformedCode =\n// `\n// // console.log('playable:${scriptIndex}:', playable);\n// eval(playable.transformedCode);\n// //        this.div.innerHTML='<pre><code>' + playable.transformedCode + '</code></pre>';\n// `;\n//       }\n      playableScript =\n`\n<script id=\"${scriptId}\">\n${transformedCode}\n</script>\n`;\n    }\n    else {\n      playableScript =\n`\n<script id=\"${scriptId}\" type=\"application/x-${language}\">${code}</script>\n`;\n\n    }\n\n    var highlightLanguage = playableType ? playableType.highlight : 'javascript';\n    var highlightedCode = global.hljs.highlightAuto(code, [highlightLanguage]).value;\n    var highlightedAugmentedCode = global.hljs.highlightAuto(registeredPlayable.augmentedCode, ['javascript']).value;\n    var showAugmentedCode = smartdown.showAugmentedCode || debug;\n    var debugIsHidden = showAugmentedCode ? '' : 'hidden';\n\n    if (autoplay && !playable) {\n      var playableWrapper =\n`\n<div class=\"playable-wrapper\">\n<div class=\"smartdown-playable smartdown-${language}\" id=\"${divId}\"></div>\n</div>\n<div id=\"${progressId}\" class=\"smartdown-progress\">\n    <div\n      class=\"smartdown-progress-bar smartdown-progress-active\"\n      data-percent=\"100\" style=\"width: 100%;\">\n      <span class=\"smartdown-progress-label\"></span>\n    </div>\n</div>\n<button\n  type=\"button\"\n  id=\"${dbgId}-toggle\"\n  href=\"#\"\n  onclick=\"smartdown.toggleDebug('${dbgId}')\"\n  ${debugIsHidden}\n  class=\"debug-button\">\n  Augmented Javascript\n</button>\n\n<pre\n  id=\"${dbgId}\"\n  class=\"playable-debug-source\">\n${highlightedAugmentedCode}\n</pre>\n\n<div class=\"playable-bottom-spacer\"></div>\n`;\n\n      return playableScript + playableWrapper;\n    }\n    else {\n      var playableButtons =\n`\n  <button type=\"button\"\n    href=\"#\"\n    id=\"${playId}\"\n    onclick=\"smartdown.playPlayable('${language}', '${divId}')\"\n    class=\"playable-button playable-button-play\">\n    <span>&#x25B6;&nbsp;&nbsp;&nbsp;Play&nbsp;&nbsp;&nbsp;&#x25B6;</span>\n  </button>\n  <button type=\"button\"\n    id=\"${stopId}\"\n    style=\"display: none\"\n    href=\"#\"\n    onclick=\"smartdown.resetPlayable('${language}', '${divId}', false)\"\n    class=\"playable-button playable-button-stop\">\n    <span>&#x25A3;&nbsp;&nbsp;&nbsp;Stop&nbsp;&nbsp;&nbsp;&#x25A3;</span>\n  </button>\n`;\n\n\n      var playableCodeDisplay =\n`\n<div class=\"playable-wrapper\">\n<div id=\"${preId}\" class=\"playable-source\">\n  <pre>${highlightedCode}</pre>\n</div>\n\n<div class=\"smartdown-playable smartdown-${language}\" id=\"${divId}\"></div>\n</div>\n<div id=\"${progressId}\" class=\"smartdown-progress\">\n    <div\n      class=\"smartdown-progress-bar smartdown-progress-active\"\n      data-percent=\"100\" style=\"width: 100%;\">\n      <span class=\"smartdown-progress-label\"></span>\n    </div>\n</div>\n\n<button\n  type=\"button\"\n  id=\"${dbgId}-toggle\"\n  href=\"#\"\n  onclick=\"smartdown.toggleDebug('${dbgId}')\"\n  ${debugIsHidden}\n  class=\"debug-button\">\n  Augmented Javascript\n</button>\n\n<pre\n  id=\"${dbgId}\"\n  class=\"playable-debug-source\">\n${highlightedAugmentedCode}\n</pre>\n\n<div class=\"playable-bottom-spacer\"></div>\n`;\n\n      return playableScript + playableButtons + playableCodeDisplay;\n    }\n  }\n  else {\n    // console.log('renderCode2', code, language);\n\n    return markedOpts.renderer.baseCodeRenderer(code, language);\n  }\n}\n\n\nfunction renderCode(code, language) {\n  language = language || '';\n  var languageElements = language.split('/');\n  var languageOpts = languageElements.slice(1);\n  var playable = languageOpts.indexOf('playable') >= 0;\n  var autoplay = languageOpts.indexOf('autoplay') >= 0;\n  // // var debug = languageOpts.indexOf('debug') >= 0;\n\n  const baseLanguage = languageElements[0];\n\n  const prelude = getPrelude(baseLanguage, code);\n\n  const bp = currentBackpatches[currentRenderDiv.id];\n\n  if ((playable || autoplay) && prelude.includes.length > 0) {\n    const backpatchIndex = bp.length;\n    const deferredCode =\n`<pre>backpatch_${backpatchIndex}_${currentRenderDiv.id}</pre>`;\n    const backpatch = {\n      currentRenderDiv: currentRenderDiv,\n      key: deferredCode,\n      replace: null\n    };\n    bp.push(backpatch);\n    // console.log('renderCode added bp', deferredCode, currentRenderDiv.id);\n\n    const includesRemaining = prelude.includes.slice(0);  // Copy\n    const prefixCode = '';\n    recursivelyLoadIncludes(prefixCode, language, includesRemaining, function(includedCode) {\n      const saveRenderDiv = currentRenderDiv;\n      // console.log('renderCode1', (currentRenderDiv ? currentRenderDiv.id : 'NOID'), includedCode.slice(0, 100));\n      currentRenderDiv = backpatch.currentRenderDiv;\n      const renderedExpandedCode = renderCodeInternal(currentRenderDiv.id, includedCode, language, prelude);\n      // console.log('renderCode2', (currentRenderDiv ? currentRenderDiv.id : 'NOID'), renderedExpandedCode.slice(0, 100));\n      currentRenderDiv = saveRenderDiv;\n      const patch = bp[backpatchIndex];\n\n      if (patch.key === deferredCode) {\n        patch.replace = renderedExpandedCode;\n      }\n      else {\n        console.log('renderCode patch anomaly', backpatchIndex);\n        console.log(deferredCode);\n        console.log(patch.key);\n      }\n    });\n\n    return deferredCode;\n  }\n  else {\n    return renderCodeInternal(currentRenderDiv.id, code, language, prelude);\n  }\n}\n\n\nfunction edit(regex, opt) {\n  regex = regex.source || regex;\n  opt = opt || '';\n  return {\n    replace: function(name, val) {\n      val = val.source || val;\n      val = val.replace(/(^|[^\\[])\\^/g, '$1');\n      regex = regex.replace(name, val);\n      return this;\n    },\n    getRegex: function() {\n      return new RegExp(regex, opt);\n    }\n  };\n}\n\n\nfunction smartdownLexer(src) {\n  var out = '',\n      link,\n      text,\n      href,\n      title,\n      cap,\n      prevCapZero;\n\n  const mathRules = /^(\\$+)[^$]*\\1/;\n  const kludgeGFMURLRules =\n    edit(/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*/)\n    // .replace('email', inline._email)\n    .getRegex();\n\n  const renderer = markedOpts.renderer;\n  while (src) {\n    // math\n    if (cap = mathRules.exec(src)) {\n      src = src.substring(cap[0].length);\n      var escaped = cap[0].replace(/</g, '< ');\n      out += escaped;\n      continue;\n    }\n\n    // escape\n    if (cap = this.rules.escape.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += cap[1];\n      continue;\n    }\n\n    // autolink\n    if (cap = this.rules.autolink.exec(src)) {\n      src = src.substring(cap[0].length);\n      if (cap[2] === '@') {\n        text = escape(this.mangle(cap[1]));\n        href = 'mailto:' + text;\n      } else {\n        text = escape(cap[1]);\n        href = text;\n      }\n      out += renderer.link(href, null, text);\n      continue;\n    }\n\n    // // url (gfm)\n    // if (!this.inLink && (cap = this.rules.url.exec(src))) {\n    if (!this.inLink && (cap = kludgeGFMURLRules.exec(src))) {\n      do {\n        prevCapZero = cap[0];\n        cap[0] = this.rules._backpedal.exec(cap[0])[0];\n      } while (prevCapZero !== cap[0]);\n      src = src.substring(cap[0].length);\n      if (cap[2] === '@') {\n        text = escape(cap[0]);\n        href = 'mailto:' + text;\n      } else {\n        text = escape(cap[0]);\n        if (cap[1] === 'www.') {\n          href = 'http://' + text;\n        } else {\n          href = text;\n        }\n      }\n      out += renderer.link(href, null, text);\n      continue;\n    }\n\n    // tag\n    if (cap = this.rules.tag.exec(src)) {\n      if (!this.inLink && /^<a /i.test(cap[0])) {\n        this.inLink = true;\n      } else if (this.inLink && /^<\\/a>/i.test(cap[0])) {\n        this.inLink = false;\n      }\n      src = src.substring(cap[0].length);\n      out += this.options.sanitize\n        ? this.options.sanitizer\n          ? this.options.sanitizer(cap[0])\n          : escape(cap[0])\n        : cap[0]\n      continue;\n    }\n\n    // link\n    if (cap = this.rules.link.exec(src)) {\n      src = src.substring(cap[0].length);\n      this.inLink = true;\n      href = cap[2];\n      if (this.options.pedantic) {\n        link = /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(href);\n\n        if (link) {\n          href = link[1];\n          title = link[3];\n        } else {\n          title = '';\n        }\n      } else {\n        title = cap[3] ? cap[3].slice(1, -1) : '';\n      }\n      href = href.trim().replace(/^<([\\s\\S]*)>$/, '$1');\n      out += this.outputLink(cap, {\n        href: markedModule.InlineLexer.escapes(href),\n        title: markedModule.InlineLexer.escapes(title)\n      });\n      this.inLink = false;\n      continue;\n    }\n\n    // reflink, nolink\n    if ((cap = this.rules.reflink.exec(src))\n        || (cap = this.rules.nolink.exec(src))) {\n      src = src.substring(cap[0].length);\n      link = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n      link = this.links[link.toLowerCase()];\n      if (!link || !link.href) {\n        out += cap[0].charAt(0);\n        src = cap[0].substring(1) + src;\n        continue;\n      }\n      this.inLink = true;\n      out += this.outputLink(cap, link);\n      this.inLink = false;\n      continue;\n    }\n\n    // strong\n    if (cap = this.rules.strong.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.strong(this.output(cap[4] || cap[3] || cap[2] || cap[1]));\n      continue;\n    }\n\n    // em\n    if (cap = this.rules.em.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.em(this.output(cap[6] || cap[5] || cap[4] || cap[3] || cap[2] || cap[1]));\n      continue;\n    }\n\n    // code\n    if (cap = this.rules.code.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.codespan(escape(cap[2].trim(), true));\n      continue;\n    }\n\n    // br\n    if (cap = this.rules.br.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.br();\n      continue;\n    }\n\n    // del (gfm)\n    if (cap = this.rules.del.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.del(this.output(cap[1]));\n      continue;\n    }\n\n    // text\n    if (cap = this.rules.text.exec(src)) {\n      src = src.substring(cap[0].length);\n      out += renderer.text(escape(this.smartypants(cap[0])));\n      continue;\n    }\n\n    if (src) {\n      throw new Error('Infinite loop on byte: ' + src.charCodeAt(0));\n    }\n  }\n\n  return out;\n}\n\nfunction isGifferable(href, title, text) {\n  return (text === 'player' ||\n          text === 'halfwidth' ||\n          text === 'fullwidth' ||\n          text === 'thumbnail') &&\n         (href.endsWith('.gif') ||\n          href.indexOf('data:image/gif;base64') === 0);\n}\n\nfunction renderImage(href, title, text) {\n  href = expandHrefWithLinkRules(href);\n  var out = '';\n  var specialClass = null;\n  var mediaLink = href.lastIndexOf('/media/', 0) >= 0;\n  if (mediaLink) {\n    var pathElements = href.split('/').reverse();\n    // console.log('render', href, pathElements);\n    var e1 = pathElements.pop();\n    if (e1 !== '') {\n      console.log('Unexpected /media syntax: ', href);\n    }\n    var e2 = pathElements.pop();\n    if (e2 === 'media') {\n      var imageName = pathElements.pop();\n      var imageClass = pathElements.pop() || '';\n\n      var fgClass = `media-image ${imageClass}`;\n      var media = mediaRegistry[imageName];\n      if (media) {\n        var inlineData = media.svgData;\n        out += '<div class=\"' + fgClass + '\">';\n        out += inlineData;\n        out += '</div>';\n      }\n      else {\n        console.log('Media not found', imageName);\n        out += '<h6 style=\"color:red;\">';\n        out += `Media not found: ${imageName}`;\n        out += '</h6>';\n      }\n    }\n  }\n  else if (href.indexOf('https://twitter.com') === 0) {\n    var showCards = (/\\&amp\\;showmedia$/i.test(href));\n    out = '<blockquote class=\"twitter-tweet\"';\n    out += ' data-width=\"250\"';\n    out += ' align=\"center\"';\n    if (!showCards) {\n      out += ' data-cards=\"hidden\"';\n    }\n    out += ' data-conversation=\"none\"';\n    out += ' data-dnt=\"true\"';\n    out += ' style=\"border:4px solid darkgray;\">';\n    out += '<a href=\"' + href + '\">' + (text || href) + '</a>';\n    out += '</blockquote>';\n  }\n  else if (isGifferable(href, title, text)) {\n    var width = (text === 'fullwidth') ?\n                  'width:100%;' :\n                  ((text === 'halfwidth' || text === 'player') ?\n                      'width:50%;' :\n                      (text === 'thumbnail' ? 'width:320px;' : ''));\n    out += `<div style=\"${width}margin:auto;padding:0;\" class=\"giffer-container\"><img style=\"padding:0;\" data-gifffer-width=\"100%\" data-gifffer=\"${href}\" data-gifffer-alt=\"${text}\"`;\n    if (title) {\n      out += ' title=\"' + title + '\"';\n    }\n    if (specialClass) {\n      out += ' class=\"' + specialClass + '\"';\n    }\n    out += this.options.xhtml ? '/>' : '></div>';\n  }\n  else if (text === 'iframe') {\n    out +=\n      `\n      <div class=\"resp-iframe-container\">\n        <iframe\n          src=\"${href}\"\n          xwidth=\"800\"\n          xheight=\"600\"\n          frameborder=\"0\"\n          allowfullscreen>\n        </iframe>\n      </div>`;\n  }\n  else if (href.endsWith('.mp3')) {\n    out += '<div style=\"margin:auto;padding:0;\">\\n';\n    out += '<audio preload=\"auto\" controls>\\n';\n    out += '<source type=\"audio/mpeg\" src=\"' + href + '\"/>\\n';\n    out += '</audio>\\n';\n    out += '</div>\\n';\n  }\n  else {\n    var youtubeEmbed = convertYoutubeFragmentToEmbed(href, text);\n    var vimeoEmbed = convertVimeoFragmentToEmbed(href, text);\n\n    if (youtubeEmbed) {\n      out += youtubeEmbed;\n    }\n    else if (vimeoEmbed) {\n      out += vimeoEmbed;\n    }\n    else if (text === 'swatch') {\n      const bgColor = href || 'pink';\n      out += `<div class=\"smartdown-swatch\" style=\"background:${bgColor}\"></div>`;\n    }\n    else {\n      const styles = {\n        default: '',\n        thumbnail: 'thumbnail',\n        halfwidth: 'halfwidth',\n        fullwidth: 'fullwidth',\n      };\n      var className = styles[text] || styles.default;\n\n      out += '<img class=\"' + className + '\" src=\"' + href + '\" alt=\"' + text + '\"';\n      if (title) {\n        out += ' title=\"' + title + '\"';\n      }\n      if (specialClass) {\n        out += ' class=\"' + specialClass + '\"';\n      }\n      out += this.options.xhtml ? '/>' : '>';\n    }\n  }\n\n  return out;\n}\n\n\nfunction importCssCode(cssCode) {\n  var styleElement = document.createElement('style');\n  styleElement.type = 'text/css';\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = cssCode;\n  }\n  else {\n    styleElement.appendChild(document.createTextNode(cssCode));\n  }\n  document.getElementsByTagName('head')[0].appendChild(styleElement);\n}\n\n\nfunction renderLink(href, title, text) {\n  const smartdownTag = ':';\n\n  var useNewWindow = true;\n  var handled = false;\n  for (var i = 0; i < linkRules.length; ++i) {\n    const rule = linkRules[i];\n    if (href.indexOf(rule.prefix) === 0) {\n      const newHRef = rule.replace + href.slice(rule.prefix.length);\n      // console.log('linkRule', href, newHRef, rule);\n      href = newHRef;\n      handled = true;\n      useNewWindow = false;\n      break;\n    }\n  }\n\n  if (handled) {\n    //\n  }\n  else if (href.indexOf(smartdownTag) === 0) {\n    // x\n  }\n  else if ((href.indexOf('http://') === -1) &&\n           (href.indexOf('https://') === -1)) {\n    href = getServiceOrigin() + href;\n  }\n\n  const titleAttr = title ? `title=\"${title}\" ` : '';\n  var linkHead = '<a ' + titleAttr +\n                 ' class=\"smartdown-link\" href=\"' +\n                 href;\n  if (useNewWindow) {\n    linkHead += '\" target=\"_blank\" rel=\"noopener\">';\n  }\n  else {\n    linkHead += '\">';\n  }\n\n  var linkBody = text;\n  var lowerhref = href.toLowerCase();\n  var linkTail = '</a>';\n  var result = linkHead + linkBody + linkTail;\n\n  if (lowerhref.indexOf(smartdownTag) === 0) {\n    var cellscript = decodeInlineScript(href.slice(smartdownTag.length));\n\n    var op = null;\n    var lhs = null;\n    var rhs = null;\n\n    if (cellscript.indexOf('?') === 0) {\n      op = 'INPUT';\n      lhs = cellscript.slice(1);\n    }\n    else if (cellscript.indexOf('-') === 0) {\n      op = 'INPUTRANGE';\n      lhs = cellscript.slice(1);\n    }\n    else if (cellscript.indexOf('X') === 0) {\n      op = 'INPUTCHECKBOX';\n      lhs = cellscript.slice(1);\n    }\n    else if (cellscript.indexOf('!') === 0) {\n      op = 'GET';\n      lhs = cellscript.slice(1);\n    }\n    else if (cellscript.indexOf('@') === 0) {\n      op = 'GO';\n      lhs = cellscript.slice(1);\n    }\n    else if (cellscript.indexOf('=') === 0) {\n      op = 'CALC';\n      cellscript = cellscript.slice(1);\n      var exprs = cellscript.split(';');\n      if (exprs.length === 1) {\n        const eqIndex = cellscript.indexOf('=');\n        lhs = [cellscript.slice(0, eqIndex)];\n        rhs = [cellscript.slice(eqIndex + 1)];\n      }\n      else {\n        lhs = [];\n        rhs = [];\n        exprs.forEach(e => {\n          const eqIndex = e.indexOf('=');\n          lhs.push(e.slice(0, eqIndex));\n          rhs.push(e.slice(eqIndex + 1));\n        });\n      }\n      // console.log('lhs/rhs', lhs, rhs);\n    }\n    else if (cellscript.indexOf('/') === 0) {\n      var parts2 = cellscript.split('@');\n      op = parts2[0];\n      lhs = parts2[1];\n    }\n    else if (cellscript.indexOf(':') === 0) {\n      op = 'REVEAL';\n      cellscript = cellscript.slice(1);\n      if (cellscript.indexOf('/') >= 0) {\n        const parts = cellscript.split('/');\n        [lhs, rhs] = parts;\n      }\n      else {\n        lhs = cellscript;\n      }\n    }\n\n    var newHTML = '';\n    var hasLabel = text && text.length > 0;\n    if (op === 'INPUT') {\n      cellIndex++;\n      var inputCellId = 'INPUT' + cellIndex;\n      const inputCellIdParts = lhs.split(/[\\|\\!]/g);\n      var inputType = 'text';\n      var liveBlur = false;\n      if (inputCellIdParts.length > 1) {\n        lhs = inputCellIdParts[0];\n        inputType = inputCellIdParts[1];\n      }\n      else {\n        liveBlur = true;\n      }\n\n      smartdownCells[inputCellId] = {\n        cellBinding: lhs,\n        cellID: inputCellId,\n        cellType: 'input',\n        datatype: inputType\n      };\n\n      if (hasLabel) {\n        newHTML += '<span class=\"infocell-group\">\\n';\n\n        newHTML += '<span class=\"infocell-group-addon\"><span class=\"infocell-label\">' + decodeURIComponent(text) + '</span></span>';\n        if (inputType === 'number') {\n          newHTML += '<input type=\"number\" class=\"infocell-input\"';\n        }\n        else {\n          newHTML += '<textarea rows=\"1\" type=\"text\" class=\"infocell-textarea\"';\n        }\n      }\n      else if (inputType === 'number') {\n        newHTML += '<input type=\"number\" class=\"infocell-input\"';\n      }\n      else {\n        newHTML += '<textarea rows=\"1\" type=\"text\" class=\"infocell-textarea\"';\n      }\n\n      if (inputType === 'number' || !liveBlur) {\n        newHTML += ' onblur=\"smartdown.setVariable(\\'' + lhs + '\\', this.value, \\'' + inputType + '\\')\"';\n      }\n      else {\n        newHTML += ' onkeyup=\"smartdown.setVariable(\\'' + lhs + '\\', this.value, \\'' + inputType + '\\')\"';\n      }\n      newHTML += ' id=\"' + inputCellId + '\"';\n      // newHTML += ' placeholder=\"' + decodeURIComponent(text) + '\" aria-describedby=\"' + lhs + '\"';\n      newHTML += '>';\n\n      if (inputType === 'number') {\n        newHTML += '\\n';\n      }\n      else {\n        newHTML += '</textarea>\\n';\n      }\n\n      if (hasLabel) {\n        newHTML += '</span>';\n      }\n    }\n    else if (op === 'INPUTRANGE') {\n      cellIndex++;\n      var inputRangeCellId = 'INPUTRANGE' + cellIndex;\n\n      var lhsElements = lhs.split('/');\n      lhs = lhsElements[0];\n\n      var min = lhsElements[1];\n      var max = lhsElements[2];\n      var step = lhsElements[3];\n\n      min = (min && min.length > 0) ? min : 0.0;\n      max = (max && max.length > 0) ? max : 100.0;\n      step = (step && step.length > 0) ? step : 1.0;\n\n      smartdownCells[inputRangeCellId] = {\n        cellBinding: lhs,\n        cellID: inputRangeCellId,\n        cellType: 'inputrange',\n        datatype: 'number'\n      };\n\n      if (hasLabel) {\n        newHTML += '<span class=\"infocell-group\">\\n';\n        newHTML += '<span class=\"infocell-group-addon\" id=\"' + lhs + '\"><span class=\"infocell-label\">' + decodeURIComponent(text) + '</span></span>';\n      }\n\n      // <input type=\"range\" min=\"5\" max=\"10\" step=\"0.01\">\n      newHTML += '<input type=\"range\"';\n      newHTML += ' class=\"infocell-input-range\"';\n      newHTML += ' style=\"width:40%;\"';\n      newHTML += ' min=\"' + min + '\"';\n      newHTML += ' max=\"' + max + '\"';\n      newHTML += ' step=\"' + step + '\"';\n      newHTML += ' id=\"' + inputRangeCellId + '\"';\n      newHTML += ' oninput=\"smartdown.setVariable(\\'' + lhs + '\\', this.valueAsNumber, \\'number\\')\"';\n      newHTML += '</input>';\n      if (hasLabel) {\n        newHTML += '</span>';\n      }\n    }\n    else if (op === 'INPUTCHECKBOX') {\n      cellIndex++;\n      var inputCheckboxCellId = 'INPUTCHECKBOX' + cellIndex;\n\n      smartdownCells[inputCheckboxCellId] = {\n        cellBinding: lhs,\n        cellID: inputCheckboxCellId,\n        cellType: 'inputcheckbox',\n        datatype: 'boolean'\n      };\n\n      if (hasLabel) {\n        newHTML += '<span class=\"infocell-group\">\\n';\n        newHTML += '<span class=\"infocell-group-addon\" id=\"' + lhs + '\"><span class=\"infocell-label\">' + decodeURIComponent(text) + '</span></span>';\n      }\n\n      newHTML += '<input type=\"checkbox\"';\n      newHTML += ' id=\"' + inputCheckboxCellId + '\"';\n      newHTML += ' onchange=\"smartdown.setVariable(\\'' + lhs + '\\', this.checked, \\'boolean\\')\"';\n      newHTML += '</input>';\n      if (hasLabel) {\n        newHTML += '</span>';\n      }\n    }\n    else if (op === 'CALC') {\n      ++cellIndex;\n      var manualInvoke = hasLabel;\n      var expr = smartdown.registerExpression(cellIndex, text, lhs, rhs, hasLabel);\n      if (manualInvoke) {\n        newHTML +=\n`<button\n  class=\"btn-infocell btn-infocell-calc\"\n  onclick=\"smartdown.computeStoredExpression('${expr.exprId}')\">\n  <span id=\"${expr.labelId}\">${expr.labelText}</span>\n</button>`;\n      }\n      else {\n        newHTML += `<span style=\"display:none;\" id=\"${expr.labelId}\"></span>`;\n      }\n    }\n    else if (op === 'GO') {\n      newHTML += '<button class=\"btn-infocell btn-infocell-go\" onclick=\"smartdown.goToCard(\\'' + lhs + '\\')\">' + decodeURIComponent(text) + '</button>';\n    }\n    else if (op === 'GET') {\n      cellIndex++;\n      var outputCellId = 'OUTPUT_' + cellIndex;\n\n      const outputCellIdParts = lhs.split(/[\\|\\!]/g);\n      var outputType = 'text';\n      if (outputCellIdParts.length > 1) {\n        lhs = outputCellIdParts[0];\n        outputType = outputCellIdParts[1];\n      }\n\n      smartdownCells[outputCellId] = {\n        cellBinding: lhs,\n        cellID: outputCellId,\n        cellType: 'output',\n        datatype: outputType\n      };\n\n      if (hasLabel) {\n        newHTML += '<span class=\"infocell-group\">\\n';\n        if (text && text.length > 0) {\n          newHTML += '<span class=\"infocell-group-addon\"><span class=\"infocell-label\">' + decodeURIComponent(text) + '</span></span>';\n        }\n      }\n\n      if (outputType !== '' && outputType !== 'text' && outputType !== 'url') {\n        var smartdownClass = 'smartdown-' + outputType;\n        newHTML += `<div class=\"infocell-output ${smartdownClass}\" id=\"${outputCellId}\"></div>`;\n      }\n      else {\n        newHTML += `<span class=\"infocell-output\" id=\"${outputCellId}\"></span>`;\n      }\n      if (hasLabel) {\n        newHTML += '</span>';\n      }\n    }\n    else if (op === 'REVEAL') {\n      const body = decodeURIComponent(text);\n\n      if (rhs === null) {\n        newHTML += `<button\n                  id=\"trigger_${lhs}\"\n                  class=\"btn-infocell btn-infocell-disclosable\"\n                  onclick=\"smartdown.toggleDisclosureButton('${lhs}','visible');\">\n                  <span id=\"span_${lhs}_closed\">&#9655;&nbsp;${body}</span>\n                  <span id=\"span_${lhs}_opened\" style=\"display: none\">&#9661;&nbsp;${body}</span>\n                  </button>`;\n      }\n      else if (rhs === 'tooltip') {\n        newHTML += `<a\n                    id=\"trigger_${lhs}\"\n                    class=\"a-disclosable\"\n                    onmouseover=\"smartdown.activatePopup('${lhs}', 'popup');\"\n                    onmouseout=\"smartdown.deactivatePopup('${lhs}', 'popup');\">${body}</a>`;\n\n      }\n    }\n\n    result = newHTML;\n  }\n\n  return result;\n}\n\nfunction renderParagraph(text) {\n  var result = '<p class=\"smartdown_p\">' + text + '</p>\\n';\n  // if (text[0] === '<') {\n  //   result = text;\n  // }\n  return result.trim();\n}\n\nfunction renderBr() {\n  return this.options.xhtml ? '<br/>' : '<br class=\"smartdown_br\">';\n}\n\n\nlet disclosableDivsOpened = 0;\n\n\nfunction renderHeading(text, level, raw) {\n\n  let result = ``;\n  const i = text.lastIndexOf('::::');\n\n  if (i >= 0) {\n    const disclosableDeclaration = text.slice(i + 4).trim();\n    text = text.slice(0, i);\n\n    if (disclosableDivsOpened > 0 && disclosableDeclaration.length === 0) {\n      disclosableDivsOpened -= 1;\n      result += `</div>`;\n    }\n    else {\n\n      disclosableDivsOpened += 1;\n\n      result += `\n              <div\n                id=\"${disclosableDeclaration}\"\n                class=\"disclosable-content\"\n              > `;\n    }\n  }\n  else {\n    result = markedOpts.renderer.baseHeadingRenderer(text, level, raw);\n  }\n  return result;\n}\n\n\n// function renderList(body, ordered, start) {\n//   var result = markedModule.Renderer.prototype.list(body, ordered, start);\n//   return result.trim();\n// }\n\n\n// function renderListItem(text) {\n//   var result = markedModule.Renderer.prototype.listitem(text);\n//   return result.trim();\n// }\n\n\n// function renderTableCell(content, flags) {\n//   console.log('renderTableCell', content, flags);\n//   var type = flags.header ? 'th' : 'td';\n//   var tag = flags.align\n//     ? '<' + type + ' style=\"text-align:' + flags.align + '\">'\n//     : '<' + type + '>';\n//   return tag + content + '</' + type + '>\\n';\n// }\n\n\nfunction enhanceMarkedAndOpts() {\n  markedModule.InlineLexer.prototype.output = smartdownLexer;\n  markedModule.InlineLexer.prototype.output.bind(markedModule.InlineLexer.prototype);\n\n  var renderer = new markedModule.Renderer();\n\n  function replace(regex, opt) {\n    regex = regex.source;\n    opt = opt || '';\n    return function self(name, val) {\n      if (!name) {\n        return new RegExp(regex, opt);\n      }\n      val = val.source || val;\n      val = val.replace(/(^|[^\\[])\\^/g, '$1');\n      regex = regex.replace(name, val);\n      return self;\n    };\n  }\n\n  /* eslint no-spaced-func: 0 */\n  /* eslint no-unexpected-multiline: 0 */\n\n  markedOpts.renderer = renderer;\n  // var aLexer = new markedModule.Lexer(markedOpts);\n  // aLexer.rules.paragraph = replace(aLexer.rules.paragraph)\n  //   ('*(#{1,6}) +', '*(#{1,6}) *')\n  //   ();\n  // aLexer.rules.heading = replace(aLexer.rules.heading)\n  //   ('*(#{1,6}) +', '*(#{1,6}) *')\n  //   ();\n\n  // renderer.$compile = null;\n  // renderer.$scope = null;\n\n  renderer.baseCodeRenderer = renderer.code;\n  renderer.code = renderCode;\n  renderer.link = renderLink;\n  renderer.image = renderImage;\n  renderer.paragraph = renderParagraph;\n  renderer.br = renderBr;\n  renderer.baseHeadingRenderer = renderer.heading;\n  renderer.heading = renderHeading;\n  // renderer.list = renderList;\n  // renderer.listitem = renderListItem;\n\n  // renderer.tablecell = renderTableCell;\n}\n\n//\n// End of marked.js extensions\n//\n\n\nfunction partitionMultipart(markdown) {\n  markdown = '\\n' + markdown; // deal with lack of leading \\n\n  var splits = markdown.split(/\\n# ([a-zA-Z0-9_]+)\\n\\-\\-\\-\\n/);\n  var result = {\n  };\n  var firstKey = null;\n  for (var i = 1; i < splits.length; i += 2) {\n    result[splits[i]] = splits[i + 1];\n    if (!firstKey) {\n      firstKey = splits[i];\n    }\n  }\n\n  const defaultKeyName = '_default_';\n  if (!firstKey) {\n    result[defaultKeyName] = markdown;\n  }\n  else {\n    result[defaultKeyName] = result[firstKey];\n  }\n\n  return result;\n}\n\nfunction registerExpression(cellIndex, labelText, lhss, rhss, manual) {\n  if (lhss.length !== rhss.length) {\n    console.log('###registerExpression, lhss.length !== rhss.length', lhss, rhss);\n    return null;\n  }\n\n  labelText = decodeInlineScript(labelText);\n  labelText = labelText.replace(/<code>/g, '`');\n  labelText = labelText.replace(/<\\/code>/g, '`');\n\n  var types = [];\n\n  for (let i = 0; i < lhss.length; ++i) {\n    let lhs = lhss[i];\n    const calcCellIdParts = lhs.split(/[\\|\\!]/g);\n    var calcType = 'text';\n    if (calcCellIdParts.length > 1) {\n      lhs = calcCellIdParts[0];\n      calcType = calcCellIdParts[1];\n    }\n    lhss[i] = lhs;\n    types.push(calcType);\n  }\n\n  var rootDivId = currentRenderDiv.id;\n  var exprId = `expr-${cellIndex}`;\n  var labelId = `label-${exprId}`;\n\n  var expr = {\n    rootDivId: rootDivId,\n    exprId: exprId,\n    labelId: labelId,\n    labelText: labelText,\n    manual: manual,\n    lhss: lhss,\n    rhss: rhss,\n    types: types\n  };\n  perPageState.expressionsRegistered[exprId] = expr;\n\n  return expr;\n}\n\n\nfunction computeExpressions() {\n  // console.log('computeExpressions', perPageState.expressionsRegistered);\n  for (var exprId in perPageState.expressionsRegistered) {\n    const entry = perPageState.expressionsRegistered[exprId];\n    if (!entry) {\n      console.log('computeExpressions DELETED', exprId);\n    }\n    else {\n      if (entry.labelId) {\n        var rootDiv = document.getElementById(entry.rootDivId);\n        var labelElement = document.getElementById(entry.labelId);\n        if (!labelElement) {\n          console.log('computeExpressions NO LABEL', entry, entry.labelId, entry.rootDivId, rootDiv);\n          // debugger;\n        }\n        else {\n          labelElement.innerHTML = expandStringWithSubstitutions(entry.labelText);\n        }\n      }\n      if (!entry.manual) {\n        smartdown.computeExpression(entry);\n      }\n    }\n  }\n}\n\nfunction registerPlayable(prelude, language, rootDivId, divId, preId, dbgId, scriptId, functionId, playId, stopId, dbgToggleId, progressId, autoplay, code, transform) {\n  var augmentedCode = code;\n  var playableType = playableTypes[language];\n\n  const imports = prelude.imports;\n  const includes = prelude.includes;\n\n  // console.log('registerPlayable', prelude, language, rootDivId, divId, preId, code.slice(0, 50), playId, stopId);\n  if (playableType.javascript) {\n    if (language === 'go' && playableType.transform) {\n      augmentedCode =\n`\n// Augmented JS to support GoDown\n// console.log('playable:${scriptIndex}:', playable);\neval(playable.transformedCode);\n//        this.div.innerHTML='<pre><code>' + playable.transformedCode + '</code></pre>';\n`;\n    }\n    else if (language === 'brython') {\n      const brythonScriptId = scriptId + '_brython';\n      augmentedCode =\n`\nconst pythonSource =\n\\`${code}\\`;\n\n\nlet s = document.getElementById('${brythonScriptId}');\nif (!s) {\n  s = document.createElement('script');\n  s.type = 'text/python3';\n  s.id = '${brythonScriptId}';\n}\n\ns.innerHTML = '';\n\ntry {\n  s.appendChild(document.createTextNode(pythonSource));\n  document.body.appendChild(s);\n} catch (e) {\n  s.text = code;\n  document.body.appendChild(s);\n}\n\nconst div = document.getElementById(\"${divId}\");\nconst smartdownPlayableContext = {\n  smartdown: smartdown,\n  divId: \"${divId}\",\n  div: div,\n  this: this,\n  env: env\n};\n\nif (typeof __BRYTHON__ === 'object') {\n  if (!__BRYTHON__.isConfiguredForSmartdown) {\n    const brythonResult = brython({\n     debug: 1,\n     static_stdlib_import: false,\n     ipy_id: []});\n    __BRYTHON__.isConfiguredForSmartdown = true;\n  }\n\n  const moduleName = '${brythonScriptId}'; // '__main__';\n  const localsId = '${brythonScriptId}';\n  const lineInfo = null;\n\n  __BRYTHON__.$options = {\n    debug: 1\n  };\n  const tree = __BRYTHON__.py2js(\n                pythonSource,\n                moduleName,\n                moduleName, // localsId,\n                lineInfo); // .to_js();\n  let js = tree.to_js();\n  var ns = __BRYTHON__.$call(__BRYTHON__.builtins.dict)();\n  __BRYTHON__.smartdown = smartdownPlayableContext;\n  __BRYTHON__.__ARGV = [smartdownPlayableContext];\n\n  eval(js, ns);\n}\nelse {\n  const errorMsg = '__BRYTHON__ is not defined. Probably due to debugging or some failure to load the Brython library';\n  console.log(errorMsg);\n  div.innerHTML = '<h4>' + errorMsg + '</h4>';\n}\n`;\n\n        // Other tactics that failed...\n\n        // eval(__BRYTHON__.py2js(src).to_js()))\n        // $B.py2js = function(src, module, locals_id, parent_scope, line_info){\n        //     // src = Python source (string)\n        //     // module = module name (string)\n        //     // locals_id = the id of the block that will be created\n        //     // parent_scope = the scope where the code is created\n        //     // line_info = [line_num, parent_block_id] if debug mode is set\n        //     //\n        //     // Returns a tree structure representing the Python source code\n\n        // {\n        //   const brythonResult = brython({\n        //    debug: 1,\n        //    ipy_id: ['${brythonScriptId}'],\n        //    args: [smartdownPlayableContext, '${brythonScriptId}']});\n        //   console.log('__BRYTHON__.__ARGV', __BRYTHON__.__ARGV);\n        // }\n        // else if (true) {\n\n        // {\n        //   const $B = __BRYTHON__;\n        //   console.log('$B defined', $B);\n        //   console.log('$B.builtins.dict', $B.builtins.dict);\n        //   var ns = $B.$call($B.builtins.dict)();\n        //   const brythonResult2 = $B.builtins.exec(pythonSource, ns);\n        //   console.log('brythonResult2', brythonResult2);\n        // }\n    }\n    else if (language.toLowerCase() === 'p5js') {\n      if (language === 'P5JS') {\n       augmentedCode =\n`\n// Augmented P5JS script to support Global Mode emulation.\n// function(${playableArgNames.join(', ')})\np5.TriOsc = P5.TriOsc;\np5.FFT = P5.FFT;\np5.Vector = P5.Vector;\n\n//P5SystemVarDecls\n${P5SystemVarDecls}\n\n//P5VarDefs\n${P5VarDefs}\n\n// -----------------\n// Begin User Script\n${code}\n// End User Script\n// -----------------\n\n//P5UserFunctionDefs\n${P5UserFunctionDefs}\n`;\n\n        // console.log('P5JS augmentedCode in registerplayable');\n        // console.log(augmentedCode);\n      }\n      else {\n        augmentedCode =\n`\n// Begin Augmented script\n// function(${playableArgNames.join(', ')})\n\np5.TriOsc = P5.TriOsc;\np5.FFT = P5.FFT;\np5.Vector = P5.Vector;\n\n// End Augmented script\n\n// Begin User Script\n${code}\n// End User Script\n`;\n      }\n    }\n  }\n\n  perPageState.playablesRegistered[divId] = {\n    language: language,\n    rootDivId: rootDivId,\n    divId: divId,\n    preId: preId,\n    dbgId: dbgId,\n    scriptId: scriptId,\n    functionId: functionId,\n    playId: playId,\n    stopId: stopId,\n    dbgToggleId: dbgToggleId,\n    progressId: progressId,\n    autoplay: autoplay,\n    playing: false,\n    dependLastValues: {},\n    p5: null,\n    embedThis: {},\n    index: perPageState.playablesRegisteredOrder.length,\n    code: code,\n    transform: transform,\n    transformedCode: null,\n    augmentedCode: augmentedCode,\n    imports: imports,\n    includes: includes,\n  };\n  perPageState.playablesRegisteredOrder.push(perPageState.playablesRegistered[divId]);\n\n  return perPageState.playablesRegistered[divId];\n}\n\n\nfunction playPlayableInternal(language, divId) {\n  var playable = perPageState.playablesRegistered[divId];\n  var div = document.getElementById(playable.divId);\n  var divPre = document.getElementById(playable.preId);\n  // var divDbg = document.getElementById(playable.dbgId);\n  // var divDbgToggle = document.getElementById(playable.dbgToggleId);\n  var play = document.getElementById(playable.playId);\n  var stop = document.getElementById(playable.stopId);\n  var script = document.getElementById(playable.scriptId);\n  var progress = document.getElementById(playable.progressId);\n  if (play) {\n    play.style.display = 'none';\n    stop.style.display = 'inline-block';\n  }\n  if (divPre) {\n    divPre.style.display = 'none';\n  }\n  div.style.display = 'block';\n  if (progress) {\n    progress.style.display = 'block';\n  }\n  playable.playing = true;\n  if (div) {\n    div.style.display = 'block';\n  }\n  var playableType = playableTypes[language];\n  if (playableType.javascript) {\n    /* eslint no-new-func: 0 */\n    var argvalues = [\n      playable,\n      smartdownVariables,\n      P5Loader,\n      window.d3v5,\n      window.d3fc,\n      window.d3dc,\n      window.topojson,\n      Plotly,\n      Leaflet,\n      Stdlib,\n      Three,\n      module.exports,\n      {}    // This will be a p5 obj in the case of using P5Loader\n    ];\n    playable.embedThis = {\n      env: smartdownVariables,\n      div: div,\n      progress: progress,\n      dependOn: [],\n      depend: null,\n      atExitHandlers: [],\n      atExit: function(func) {\n        // console.log('atExit', func, this);\n        this.atExitHandlers.push(func);\n      }\n    };\n\n    if (language.toLowerCase() !== 'p5js') {\n      let func = new Function(...playableArgNames, script.text);\n      try {\n        const embedResult = func.apply(playable.embedThis, argvalues);\n        if (language === 'leaflet') {\n          if (!playable.embedThis.leafletMap) {\n            playable.embedThis.leafletMap = embedResult;\n          }\n        }\n      }\n      catch (e) {\n        console.log('#### Error playing ', language, e);\n        div.innerHTML =\n`\n<pre><code style=\"color:tomato;\">\n<b>Error Initializing ${language}</b>\n${e}\n</code></pre>\n`;\n      }\n    }\n    else {\n      // if (playable.language === 'P5JS') {\n      //   playable.augmentedCode =\n      //     `\n      //     // Augmented P5JS script to support Global Mode emulation.\n      //     // function(${playableArgNames.join(', ')})\n      //     p5.TriOsc = P5.TriOsc;\n      //     p5.FFT = P5.FFT;\n      //     p5.Vector = P5.Vector;\n\n      //     //P5SystemVarDecls\n      //     ${P5SystemVarDecls}\n\n      //     //P5VarDefs\n      //     ${P5VarDefs}\n\n      //     // -----------------\n      //     // Begin User Script\n      //     ${playable.code}\n      //     // End User Script\n      //     // -----------------\n\n      //     //P5UserFunctionDefs\n      //     ${P5UserFunctionDefs}\n      //     `;\n      // }\n      // else {\n      //   playable.augmentedCode =\n      //     `\n      //     // Augmented P5JS script\n      //     // function(${playableArgNames.join(', ')})\n\n      //     p5.TriOsc = P5.TriOsc;\n      //     p5.FFT = P5.FFT;\n      //     p5.Vector = P5.Vector;\n\n      //     // -----------------\n      //     // Begin User Script\n      //     ${playable.code}\n      //     // End User Script\n      //     // -----------------\n      //     `;\n      // }\n\n      // divDbg.innerHTML = playable.augmentedCode;\n      let func = new Function(...playableArgNames, playable.augmentedCode);\n\n      /* eslint no-eval: 0 */\n\n      // /* eslint no-inner-declarations: 0 */\n      // function patchedDisposeSound() {\n      //   /* eslint no-invalid-this: 0 */\n      //   for (var i = 0; i < P5Loader.soundOut.soundArray.length; i++) {\n      //     var soundResource = P5Loader.soundOut.soundArray[i];\n      //     if (!soundResource.owner ||\n      //         soundResource.owner === this) {\n      //       // console.log('DISPOSE [' + i + '] disposeSound soundResource:', soundResource);\n      //       soundResource.dispose();\n      //     }\n      //   }\n      // }\n\n      // var removeHandlers = P5Loader.prototype._registeredMethods.remove;\n      // for (var i = 0; i < removeHandlers.length; ++i) {\n      //   if (removeHandlers[i] === P5Loader.prototype.disposeSound) {\n      //     removeHandlers[i] = patchedDisposeSound;\n      //   }\n      // }\n\n      // var oldmousemove = P5Loader.prototype._onmousemove;\n      // P5Loader.prototype._onmousemove = function(e) {\n      //   console.log('onmousemove', e);\n      // };\n      // var oldtouchend = P5Loader.prototype._ontouchend;\n      P5Loader.prototype._ontouchend = function (e) {\n        // Smartdown addition to capture page dimensions\n        e.clientX = e.pageX;\n        e.clientY = e.pageY;\n        // return oldtouchend.apply(this, arguments);\n\n\n        // This code will be needed until a fix is made to 0.5.8 of P5JS\n        // Copied from 0.5.8 of P5JS\n        // Working around bug in https://github.com/processing/p5.js/pull/1820/files\n\n        this._updateTouchCoords(e);\n        this._updateNextMouseCoords(e);\n        if (this.touches.length === 0) {\n          this._setProperty('touchIsDown', false);\n        }\n        var context = this._isGlobal ? window : this;\n        var executeDefault;\n        if (typeof context.touchEnded === 'function') {\n          executeDefault = context.touchEnded(e);\n          if (executeDefault === false) {\n            e.preventDefault();\n          }\n        }\n        else if (typeof context.mouseReleased === 'function') {\n          executeDefault = context.mouseReleased(e);\n          if (executeDefault === false) {\n            e.preventDefault();\n          }\n        }\n        // BUGGY 0.58 code: else {\n        // BUGGY 0.58 code:   e.preventDefault();\n        // BUGGY 0.58 code:   return false;\n        // BUGGY 0.58 code: }\n      };\n\n      playable.embedThis.IAMP5 = 'IAMP5';\n      func = func.bind(\n        playable.embedThis,\n        ...(argvalues.slice(0, -1))\n      );\n\n      try {\n        var myP5 = new P5Loader(func, div);\n        // console.log('myP5', myP5);\n        myP5.frameRate(25);\n        myP5._onresize();\n        function keydownHandler(e) {\n          // console.log('keydownHandler', e.target.tagName, e);\n          var ignoreKeys = [\n            myP5.LEFT_ARROW,\n            myP5.RIGHT_ARROW,\n            myP5.UP_ARROW,\n            myP5.DOWN_ARROW,\n            32\n          ];\n\n          if (e.target.tagName === 'BODY' && ignoreKeys.indexOf(e.keyCode) >= 0) {\n            // console.log('ignoring', e);\n            e.preventDefault();\n          }\n        }\n        myP5.keydownHandler = keydownHandler;\n        window.addEventListener('keydown', keydownHandler, false);\n\n        playable.p5 = myP5;\n      }\n      catch (e) {\n        console.log('#### Error initializing P5JS', e);\n        div.innerHTML =\n`\n<pre><code style=\"color:tomato;\">\n<b>Error Initializing P5JS</b>\n${e}\n</code></pre>\n`;\n        // resetPlayable(language, divId);\n      }\n    }\n\n    if (playable && playable.playing) {\n      const { depend, dependOn } = playable.embedThis;\n      const lastValues = playable.dependLastValues;\n      const possiblyModifiedProgressDiv = playable.embedThis.progress;\n\n      if (depend) {\n        let signal = false;\n        if (dependOn) {\n          let atLeastOneUndefined = false;\n          dependOn.forEach(varname => {\n            // console.log('...varname', varname, lastValues[varname]);\n\n            const newValue = smartdownVariables[varname];\n            if (newValue === undefined) {\n              atLeastOneUndefined = true;\n            }\n            lastValues[varname] = newValue;\n          });\n          signal = !atLeastOneUndefined;\n        }\n        else {\n          signal = true;\n        }\n\n        if (signal) {\n          if (possiblyModifiedProgressDiv) {\n            possiblyModifiedProgressDiv.style.display = 'none';\n          }\n          depend.apply(playable.embedThis);\n        }\n      }\n      else if (possiblyModifiedProgressDiv) {\n        possiblyModifiedProgressDiv.style.display = 'none';\n      }\n    }\n  }\n  else if (language === 'mermaid') {\n    mermaidRender(div, script.text);\n\n    if (progress) {\n      progress.style.display = 'none';\n    }\n  }\n  else if (language === 'graphviz') {\n    div.innerHTML = '<i>...rendering graphviz...</i>';\n    jsModules.graphviz.loader(function () {\n      var options = {\n        images: graphvizImages\n      };\n      (new Viz()).renderString(script.text, options).then(result => {\n        if (progress) {\n          progress.style.display = 'none';\n        }\n        div.innerHTML = result;\n      });\n    });\n  }\n}\n\n\nfunction recursivelyLoadImports(language, divId, importsRemaining, done) {\n  if (importsRemaining.length > 0) {\n    const nextImport = importsRemaining.shift();\n    // console.log('nextImport', nextImport);\n\n    // DRY THIS UP\n\n\n    if (nextImport === 'stdlib') {\n      smartdown.jsModules.stdlib.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'd3') {\n      smartdown.jsModules.d3.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'brython') {\n      smartdown.jsModules.brython.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport.toLowerCase() === 'p5js') {\n      smartdown.jsModules.p5js.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'three') {\n      smartdown.jsModules.three.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'ldf') {\n      smartdown.jsModules.ldf.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'plotly') {\n      smartdown.jsModules.plotly.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'graphviz') {\n      smartdown.jsModules.graphviz.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else if (nextImport === 'mermaid') {\n      smartdown.jsModules.mermaid.loader(function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n    else {\n      loadExternal(nextImport, function () {\n        recursivelyLoadImports(language, divId, importsRemaining, done);\n      });\n    }\n  }\n  else if (done) {\n    done();\n  }\n}\n\nfunction playPlayable(language, divId) {\n  var playable = perPageState.playablesRegistered[divId];\n  if (playable) {\n    const importsRemaining = playable.imports.slice(0);  // Copy\n\n    recursivelyLoadImports(language, divId, importsRemaining, function() {\n      playPlayableInternal(language, divId);\n    });\n  }\n  else {\n    console.log('playPlayable... not found', language, divId, perPageState.playablesRegistered, perPageState.playablesRegisteredOrder);\n  }\n}\n\n\nfunction resetPlayable(language, divId, throwAway) {\n  var playable = perPageState.playablesRegistered[divId];\n  if (!playable.playing) {\n    // console.log('resetPlayable NOT PLAYING', language, divId);\n  }\n  else {\n    // console.log('resetPlayable PLAYING', playable.divId, playable);\n    var div = document.getElementById(playable.divId);\n    var play = document.getElementById(playable.playId);\n    var stop = document.getElementById(playable.stopId);\n    var progress = document.getElementById(playable.progressId);\n    if (play) {\n      play.style.display = 'inline-block';\n      stop.style.display = 'none';\n    }\n\n    if (progress) {\n      progress.style.display = 'none';\n    }\n\n    var divPre = document.getElementById(playable.preId);\n    if (divPre && !throwAway) {\n      divPre.style.display = 'block';\n    }\n\n    var playableType = playableTypes[language];\n\n    playable.playing = false;\n\n    div.style.display = 'none';\n    if (playableType.javascript) {\n      const atExitHandlers = playable.embedThis.atExitHandlers;\n      atExitHandlers.forEach(function(func) {\n        // console.log('resetPlayable... calling atExitHandler', func);\n        func();\n      });\n      if (language.toLowerCase() === 'p5js') {\n        var myP5 = playable.p5;\n        if (myP5) {\n          window.removeEventListener('keydown', myP5.keydownHandler);\n          // myP5.noLoop();\n          playable.p5 = null;\n          myP5.remove();\n          if (div) {\n            var canvas = div.getElementsByTagName('canvas');\n            if (canvas && canvas.length > 0) {\n              div.removeChild(canvas[0]);\n            }\n          }\n        }\n      }\n      else if (language === 'leaflet') {\n        if (!playable.embedThis) {\n          console.log('   playable.embedThis', playable.embedThis, playable, divId);\n        }\n        if (playable.embedThis.leafletMap) {\n          // console.log('leaflet playable.embedThis.leafletMap', playable.embedThis.leafletMap);\n          playable.embedThis.leafletMap.remove();\n          delete playable.embedThis.leafletMap;\n        }\n      }\n      else if (language === 'go') {\n        if (playable.isGodownMain) {\n          try {\n            /* global Godown_Shutdown */\n            Godown_Shutdown();\n          }\n          catch (e) {\n            console.log('exception from runtime.Goexit', e);\n          }\n        }\n      }\n    }\n\n    div.innerHTML = '';\n  }\n\n}\n\n\nfunction toggleDebug(divId) {\n  var div = document.getElementById(divId);\n  const newStyle = (div.style.display === 'block' ? 'none' : 'block');\n  div.style.display = newStyle;\n}\n\n\nfunction activatePopup(divId) {\n  var div = document.getElementById(divId);\n  const trigger = document.getElementById(`trigger_${divId}`);\n  div.style.position = 'absolute';\n  div.style.top = `${trigger.offsetTop + trigger.offsetHeight}px`;\n  const padding = 20;\n  div.style.padding = `${padding}px ${padding}px`;\n  const popupWidth = Math.floor(window.innerWidth / 3) + 2 * padding;\n\n  if ((trigger.offsetLeft + popupWidth) < window.innerWidth) {\n    div.style.left = `${trigger.offsetLeft}px`;\n  }\n  else {\n    const popupLeft = trigger.offsetLeft + trigger.offsetWidth - popupWidth;\n    div.style.left = `${popupLeft}px`;\n  }\n  div.classList.toggle('popup');\n}\n\n\nfunction deactivatePopup(divId) {\n  var div = document.getElementById(divId);\n  div.classList.toggle('popup');\n}\n\nfunction toggleDisclosureButton(divId, disclosureType) {\n  var div = document.getElementById(divId);\n  // console.log('td', divId, div);\n  const willBeOpen = !div.classList.contains(disclosureType);\n  div.classList.toggle(disclosureType);\n\n  var openedSpan = document.getElementById(`span_${divId}_opened`);\n  openedSpan.style.display = willBeOpen ? 'inline' : 'none';\n  var closedSpan = document.getElementById(`span_${divId}_closed`);\n  closedSpan.style.display = willBeOpen ? 'none' : 'inline';\n\n}\n\n\nfunction toggleDisclosure(divId, disclosureType) {\n  var div = document.getElementById(divId);\n  // console.log('td', divId, div);\n  const willBeOpen = !div.classList.contains(disclosureType);\n\n  div.classList.toggle(disclosureType);\n\n}\n\n\nfunction pause() {\n  each(perPageState.playablesRegisteredOrder, function (playable) {\n    if (playable && playable.p5) {\n      playable.p5.getAudioContext().suspend();\n    }\n  });\n}\n\n\nfunction resume() {\n  each(perPageState.playablesRegisteredOrder, function (playable) {\n    if (playable && playable.p5) {\n      playable.p5.getAudioContext().resume();\n    }\n  });\n}\n\n\nfunction handleVisibilityChange() {\n  if (document.hidden) {\n    pause();\n  }\n  else {\n    resume();\n  }\n}\n\n\nfunction startAutoplay(outputDiv) {\n  // console.log('startAutoplay', outputDiv, mermaid, mermaidAPI);\n\n  if (outputDiv && outputDiv.id) {\n    each(perPageState.playablesRegisteredOrder, function(playable) {\n      // console.log('startAutoplay', outputDiv, outputDiv.id, playable);\n      if (playable.autoplay && !playable.playing) {\n        var sel = '#' + outputDiv.id + ' #' + playable.divId;\n        var divHere = document.querySelectorAll(sel);\n        if (divHere && divHere.length > 0) {\n          playPlayable(\n            playable.language,\n            playable.divId);\n        }\n        else {\n          // console.log('...startAutoplay DIV NOT FOUND', sel, outputDiv, outputDiv.id, playable);\n        }\n      }\n    });\n  }\n}\n\nfunction resetPerPageState() {\n  perPageState.expressionsRegistered = {};\n  perPageState.playablesRegistered = {};\n  perPageState.playablesRegisteredOrder = [];\n}\n\n\nfunction cleanupOrphanedStuff() {\n  const newER = {};\n  for (var exprId in perPageState.expressionsRegistered) {\n    const expr = perPageState.expressionsRegistered[exprId];\n    if (!expr) {\n      // console.log('cleanupOrphanedStuff expr DELETED', exprId);\n    }\n    else {\n      var element = document.getElementById(expr.rootDivId);\n      var labelElement = document.getElementById(expr.labelId);\n      // console.log('cleanupOrphanedStuff/expr', expr.rootDivId, expr);\n      if (element && labelElement) {\n        newER[expr.exprId] = expr;\n        // console.log('...cleanupOrphanedStuff/expr div found', expr.rootDivId, expr, element);\n      }\n      else {\n        // console.log('...cleanupOrphanedStuff/expr divs not found', expr.rootDivId, expr.labelId, expr, element, labelElement);\n      }\n    }\n  }\n  perPageState.expressionsRegistered = newER;\n\n  const newPRO = [];\n  const newPR = {};\n\n  each(perPageState.playablesRegisteredOrder, function (playable) {\n    // console.log('cleanupOrphanedStuff/playable', playable.divId, playable.scriptId, playable);\n    var element1 = document.getElementById(playable.divId);\n    var element2 = document.getElementById(playable.scriptId);\n\n    if (element1 && element2) {\n      newPRO.push(playable);\n      newPR[playable.divId] = playable;\n      // console.log('...cleanupOrphanedStuff/playable div found', playable.playing, playable.divId, playable.scriptId, playable, element1, element2);\n    }\n    else {\n      playable.deleted = true;\n      // console.log('...cleanupOrphanedStuff/playable div not found', playable.playing, playable.divId, playable.scriptId, playable, element1, element2);\n    }\n  });\n\n  // console.log('pruning candidates old/new');\n  // console.log(perPageState.playablesRegistered);\n  // console.log(newPR);\n  // console.log(perPageState.playablesRegisteredOrder);\n  // console.log(newPRO);\n\n  perPageState.playablesRegistered = newPR;\n  perPageState.playablesRegisteredOrder = newPRO;\n\n  // console.log('newPRO', newPRO);\n}\n\n\nfunction resetAllPlayables(outputDiv, throwAway) {\n  // console.log('resetAllPlayables', perPageState.playablesRegisteredOrder);\n  each(perPageState.playablesRegisteredOrder, function (playable) {\n    if ((outputDiv.id === playable.rootDivId) && playable.divId) {\n      const playableElement = document.getElementById(playable.divId);\n      if (playableElement) {\n        // console.log('resetAllPlayables', playable.divId, playableElement, perPageState.playablesRegisteredOrder);\n        const playableScript = document.getElementById(playable.scriptId);\n        if (playableScript) {\n          resetPlayable(\n            playable.language,\n            playable.divId,\n            throwAway\n          );\n        }\n        else {\n          console.log('resetAllPlayables SCRIPT DIV NOT FOUND', outputDiv.id, playable.divId, playable.scriptId, playable);\n        }\n      }\n      else {\n        console.log('resetAllPlayables PLAYABLE DIV NOT FOUND', outputDiv.id, playable.divId, playable.scriptId, playable);\n      }\n    }\n  });\n\n  pause();\n}\n\n\nfunction transformPlayables(outputDiv, done) {\n  var playablesToTransform = [];\n  if (window.godownTranslate) {\n    each(perPageState.playablesRegisteredOrder, function (playable) {\n      if (playable.transform) {\n        if (outputDiv.id) {\n          var sel = '#' + outputDiv.id + ' #' + playable.scriptId;\n          var divHere = document.querySelectorAll(sel);\n          if (divHere && divHere.length > 0) {\n            playablesToTransform.push(playable);\n          }\n        }\n      }\n    });\n  }\n\n  function recursiveTransform(playablesToTransform, done) {\n    if (playablesToTransform.length === 0) {\n      done();\n    }\n    else {\n      var playable = playablesToTransform[0];\n      var code = playable.code;\n      var packageIndex = code.indexOf('package ');\n\n      if (packageIndex === 0) {\n        var packageEndIndex = code.indexOf('\\n');\n        if (packageEndIndex !== 0) {\n          var packageName = code.slice('package '.length, packageEndIndex);\n\n          var divAccessCode =\n`\nwindow.godownDiv_${packageName} = '${playable.divId}';\nconsole.log('window.godownDiv_${packageName}', window.godownDiv_${packageName});\n`;\n          try {\n            window.godownTranslate(packageName, code, function (transformedCodeResult) {\n              playable.isGodownMain = packageName === 'main';\n              playable.transformedCode = divAccessCode + transformedCodeResult;\n              recursiveTransform(playablesToTransform.slice(1), done);\n            });\n          }\n          catch (e) {\n            console.log('# Exception during transform', e);\n          }\n        }\n      }\n    }\n  }\n\n  recursiveTransform(playablesToTransform, done);\n}\n\n\nfunction configure(options, configurationCompletedHandler) {\n  const loadedHandler = configurationCompletedHandler;\n  const media = options.media;\n  const _baseURL = options.baseURL;\n  const _cardLoader = options.cardLoader;\n  const _calcHandlers = options.calcHandlers;\n  const _linkRules = options.linkRules;\n\n  document.addEventListener('visibilitychange', handleVisibilityChange);\n\n  /* global navigator */\n  if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {\n    document.querySelector('meta[name=viewport]')\n      .setAttribute(\n        'content',\n        'initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no'\n      );\n  }\n\n  cardLoader = _cardLoader;\n  calcHandlers = _calcHandlers;\n\n  if (_linkRules) {\n    setLinkRules(_linkRules);\n  }\n\n  mediaRegistry = media || {};\n  window.mediaRegistry = mediaRegistry;\n\n  /* global MathJax */\n  /* eslint-disable */\n  /* eslint new-cap: 0 */\n  /* eslint no-native-reassign: 0 */\n  /* eslint no-trailing-spaces: 0 */\n  /* global smartdown */\n  function svgLoaded() {\n    /* eslint no-invalid-this: 0 */\n    var sourceText = this.responseText;\n    var media = mediaRegistry[this.svgKey];\n    media.svgData = sourceText;\n    media.type = 'svginline';\n    // console.log('svgLoaded', this.svgKey, media, sourceText.slice(0, 40));\n  }\n\n  for (var key in mediaRegistry) {\n    var url = mediaRegistry[key];\n    mediaRegistry[key] = {\n      type: '',\n      url: '',\n      expandedurl: '',\n      svgData: '',\n    };\n\n    if (url.indexOf('<svg ') === 0) {\n      mediaRegistry[key].type = 'svg';\n      mediaRegistry[key].url = key;\n      mediaRegistry[key].expandedurl = key;\n      mediaRegistry[key].svgData = url;\n    }\n    else if (url.endsWith('.svg')) {\n      var oReq = new XMLHttpRequest();\n      oReq.svgKey = key;\n      oReq.addEventListener('load', svgLoaded);\n      mediaRegistry[key].type = 'svg';\n      mediaRegistry[key].url = url;\n      mediaRegistry[key].expandedurl = expandHrefWithLinkRules(url);\n      oReq.open('GET', mediaRegistry[key].expandedurl);\n      oReq.send();\n    }\n    else {\n      mediaRegistry[key].type = 'url';\n      mediaRegistry[key].url = url;\n      mediaRegistry[key].expandedurl = expandHrefWithLinkRules(url);\n    }\n  }\n\n  baseURL = _baseURL || (window.location.origin + '/');\n  window.xypicURL = baseURL + 'lib/xypic.js';\n\n  const st = StackTrace.getSync();\n  const currentBase = st[0].fileName;\n  const lastSlash = currentBase.lastIndexOf('/');\n  __webpack_public_path__ = currentBase.slice(0, lastSlash + 1);\n  console.log('__webpack_public_path__', __webpack_public_path__);\n\n  window.MathJax = {\n    delayStartupUntil: 'configured',\n    AuthorInit: function() {\n      MathJax.Ajax.fileRev = function (file) {\n        var ver = MathJax.cdnFileVersions[file] || MathJax.cdnVersion || '';\n        if (ver) ver = '?ver='+ver;\n        if (file.indexOf('xypic.js') !== -1) {\n          ver = '';\n        }\n        return ver;\n      }\n    }\n  };\n\n  if (isTesting) {\n    enhanceMarkedAndOpts();\n    window.setTimeout(loadedHandler, 0);\n  }\n  else {\n    function completeStartup() {\n      enhanceMarkedAndOpts();\n      window.setTimeout(loadedHandler, 0);\n    }\n\n    if (useMathJax) {\n      importScriptUrl(\n        //xyjax doesn't work here\n        'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML-full&delayStartupUntil=configured',\n        function() {\n          mathjaxConfigure();\n\n          MathJax.Hub.Register.StartupHook(\n            'End',\n            function() {\n              completeStartup();\n            });\n\n          MathJax.Hub.Configured();\n        });\n    }\n    else {\n      completeStartup();\n    }\n  }\n}\n\n\nfunction initialize(media, baseURL, loadedHandler, cardLoader, calcHandlers, linkRules) {\n  const options = {\n    media: media,\n    baseURL: baseURL,\n    cardLoader: cardLoader,\n    calcHandlers: calcHandlers,\n    linkRules: linkRules\n  };\n\n  configure(options, loadedHandler);\n}\n\nvar patchesUnresolvedKludgeLimit = 0;\n\nfunction renderCell(cellID, variableId, newValue) {\n  const cellInfo = smartdownCells[cellID];\n\n  var element = document.getElementById(cellID);\n  // console.log('renderCell', cellInfo, newValue, element, element.type, element.tagName, cellInfo.cellType, cellInfo.datatype, s);\n  var s = JSON.stringify(newValue, null, 2);\n  if (s) {\n    s = s.slice(0, 20);\n  }\n  if (!element) {\n    console.log('...renderCell cellID not found', cellID, variableId, newValue);\n  }\n  else if (element.type === 'checkbox') {\n    element.checked = !!newValue;\n  }\n  else if (cellInfo.cellType === 'inputrange') {\n    element.value = newValue;\n  }\n  else if (cellInfo.datatype === 'code') {\n    if (newValue === undefined) {\n      element.innerHTML = '';\n    }\n    else {\n      element.innerHTML = '<pre class=\"infocell-output-pre\">' + entityEscape(newValue) + '</pre>';\n    }\n  }\n  else if (cellInfo.datatype === 'json') {\n    const stringified = JSON.stringify(newValue, null, 2);\n    const escaped = entityEscape(stringified, true);\n    // console.log('stringified', stringified);\n    element.innerHTML = '<pre class=\"infocell-output-pre\">' + escaped + '</pre>';\n  }\n  else if (cellInfo.datatype === 'url') {\n    // console.log('cellInfo', cellInfo);\n    element.innerHTML = `<a target=\"_blank\" rel=\"noopener\" href=\"${newValue}\" style=\"word-break:break-all;font-size:0.9em;line-height:1.15em;\">${newValue}</a>`;\n  }\n  else if (cellInfo.datatype === 'markdown') {\n    if (typeof newValue === 'string') {\n      smartdown.setSmartdown(newValue, element);\n    }\n    else {\n      element.innerHTML = '';\n    }\n  }\n  else if (cellInfo.datatype === 'graphviz') {\n    element.innerHTML = '<i>...rendering graphviz...</i>';\n    if (typeof newValue === 'string' && newValue.length > 0) {\n      jsModules.graphviz.loader(function () {\n        var options = {\n          images: graphvizImages\n        };\n        (new Viz()).renderString(newValue, options).then(result => {\n          element.innerHTML = result;\n        });\n      });\n    }\n  }\n  else if (cellInfo.datatype === 'svg') {\n    element.innerHTML = newValue;\n  }\n  else if (cellInfo.datatype === 'mermaid') {\n    if (newValue === undefined) {\n      element.innerHTML = '';\n    }\n    else {\n      mermaidRender(element, newValue);\n    }\n  }\n  else if (Array.isArray(newValue)) {\n    // console.log('array', newValue, newValue.elementType);\n    const isImage = newValue.elementType === 'image';\n    const isURLTitle = newValue.elementType === 'title/url';\n    var elementList = '<ul class=\"infocell-output-list\">';\n    for (var elementIndex = 0; elementIndex < newValue.length; ++elementIndex) {\n      var newElement = newValue[elementIndex];\n      if (isImage) {\n        elementList += '<li><img src=\"' + newElement + '\"></li>';\n      }\n      else if (isURLTitle) {\n        elementList += '<li><a target=\"_blank\" rel=\"noopener\" href=\"' + newElement.url + '\">' + newElement.title + '</a></li>';\n      }\n      else if (typeof newElement === 'string') {\n        elementList += '<li>' + newElement + '</li>';\n      }\n      else {\n        elementList += '<li>' + '<pre class=\"infocell-output-pre\">' + JSON.stringify(newElement, null, 2) + '</pre>' + '</li>';\n      }\n    }\n    elementList += '</ul>';\n    element.innerHTML = elementList;\n  }\n  else if (typeof newValue === 'object') {\n    element.innerHTML = '<pre class=\"infocell-output-pre\">' + JSON.stringify(newValue, null, 2) + '</pre>';\n    // element.value = newValue;\n  }\n  else if (typeof newValue === 'string' && newValue.indexOf('https://upload.wikimedia.org') === 0) {\n    element.innerHTML = '<img src=\"' + newValue + '\">';\n  }\n  else if (newValue === undefined) {\n    element.innerHTML = '';\n  }\n  else {\n    if (element.tagName === 'TEXTAREA') {\n      element.value = newValue; // newValue.replace('\\n', '<br>');\n    }\n    else if (typeof newValue === 'string') {\n      element.innerHTML = entityEscape(newValue); // .replace(/\\n/g, '<br>');\n    }\n    else {\n      element.innerHTML = newValue; //  = newValue.replace(/\\n/g, '<br>');\n      element.value = newValue; //  = newValue.replace(/\\n/g, '<br>');\n    }\n  }\n}\n\n\nfunction propagateModel() {\n  ensureCells();\n  ensureVariables();\n  each(smartdownVariables, function (v, k) {\n    propagateChangedVariable(k, v);\n  });\n}\n\n\nfunction updateProcesses(id, newValue) {\n  // console.log('.....updateProcesses', id, newValue);\n  smartdown.computeExpressions();\n\n  if (id) {\n    // each(smartdownCells, function(newCell, cellID) {\n    //   console.log('........newCellCheck', id, newCell, newCell.cellBinding, cellID);\n    // });\n    each(smartdownCells, function(newCell, cellID) {\n      // console.log('........newCell', id, newCell, newCell.cellBinding, cellID);\n\n      if (id === newCell.cellBinding) {\n        renderCell(cellID, newCell.cellBinding, newValue);\n      }\n    });\n  }\n  else {\n    each(smartdownCells, function(newCell, cellID) {\n      const oldValue = smartdownVariables[newCell.cellBinding];\n      renderCell(cellID, newCell.cellBinding, oldValue);\n    });\n  }\n\n  each(perPageState.playablesRegisteredOrder, function (playable) {\n    if (playable) {\n      let progress = document.getElementById(playable.progressId);\n\n      if (playable.playing) {\n        const {depend, dependOn} = playable.embedThis;\n        // console.log('.........playable', playable, dependOn, depend);\n        if (depend) {\n          let signal = false;\n\n          if (dependOn) {\n            let atLeastOneUndefined = false;\n            dependOn.forEach(varname => {\n              const oldValue = playable.dependLastValues[varname];\n              const newValue = smartdownVariables[varname];\n              playable.dependLastValues[varname] = newValue;\n              if (newValue === undefined) {\n                atLeastOneUndefined = true;\n              }\n\n              // console.log('............varname', varname, oldValue, newValue);\n\n              if (!areValuesSameEnough(oldValue, newValue)) {\n                signal = true;\n              }\n            });\n            if (atLeastOneUndefined) {\n              signal = false;\n            }\n          }\n          else {\n            signal = true;\n          }\n\n          if (signal) {\n            if (progress) {\n              progress.style.display = 'none';\n            }\n            depend.apply(playable.embedThis);\n          }\n        }\n      }\n      else {\n        if (progress) {\n          progress.style.display = 'none';\n        }\n      }\n    }\n  });\n}\n\n\nfunction changeVariable(id, newValue) {\n  smartdownVariables[id] = newValue;\n  if (useLocalForage) {\n    const key = localForageSmartdownPrefix + id;\n    const value = newValue;\n    localForage.setItem(key, value).then(function () {\n    }).catch(function (err) {\n      console.log('localForage STORE ERROR', key, value, err);\n    });\n  }\n}\n\nfunction propagateChangedVariable(id, newValue, force) {\n  const oldValue = smartdownVariables[id];\n  changeVariable(id, newValue);\n  // console.log('...propagateChangedVariable', id, oldValue, newValue, areValuesSameEnough(oldValue, newValue), smartdownVariables);\n\n  if (force || !areValuesSameEnough(oldValue, newValue)) {\n    updateProcesses(id, newValue);\n  }\n}\n\n\nfunction ensureCells() {\n  each(smartdownCells, function(newCell, cellID) {\n    var element = document.getElementById(cellID);\n    if (!element) {\n      // console.log('...ensureCells element for cellID not found', cellID, smartdownCells[cellID]);\n      delete smartdownCells[cellID];\n    }\n  });\n}\n\n\nfunction ensureVariables() {\n  each(smartdownCells, function(newCell, cellID) {\n    let oldValue = smartdownVariables[newCell.cellBinding];\n    changeVariable(newCell.cellBinding, oldValue);\n  });\n}\n\nfunction resetVariables() {\n  smartdownVariables = {};\n  changeVariable(null, null);\n  ensureVariables();\n}\n\nvar scrollHoverDisableEnabled = false;\nvar lastY;\n\nfunction setupScrollHoverDisable() {\n  lastY = 0;\n  if (!scrollHoverDisableEnabled) {\n    var timer;\n    scrollHoverDisableEnabled = true;\n    // https://www.thecssninja.com/css/pointer-events-60fps\n    var body = document.getElementsByTagName('body')[0];\n    window.addEventListener('scroll', function(e) {\n      var currentY = window.scrollY;\n      var delta = Math.abs(lastY - currentY);\n\n      if (delta > 25) {\n        body.classList.add('disable-hover');\n\n        clearTimeout(timer);\n        timer = setTimeout(function() {\n          body.classList.remove('disable-hover');\n        }, 700);\n      }\n      lastY = currentY;\n    }, false);  }\n}\n\n\n\nfunction setSmartdown(md, outputDiv, done) {\n  if (currentRenderDiv) {\n    console.log('setSmartdown REENTRANCY FAIL', currentRenderDiv.id, md.slice(0, 40));\n  }\n  else {\n    currentRenderDiv = outputDiv;\n  }\n  currentBackpatches[outputDiv.id] = [];\n\n  setupScrollHoverDisable();\n  cleanupOrphanedStuff();\n  resetAllPlayables(outputDiv, true);\n\n  function completeTypeset() {\n    // console.log('MathJax.Message.Log()', MathJax.Message.Log());\n    var that = this;\n    var resizeTimeout;\n    function actualResizeHandler() {\n      for (var k in perPageState.playablesRegistered) {\n        var playable = perPageState.playablesRegistered[k];\n        if (usePlotly) {\n          if (playable.playing && playable.language === 'plotly') {\n            var d = document.getElementById(playable.divId);\n            if (d) {\n              try {\n                // Plotly.Plots.resize(d);\n                var newLayout = {autosize: true};\n                if (smartdownVariables.PLOT_TITLE) {\n                  newLayout.title = smartdownVariables.PLOT_TITLE;\n                }\n                Plotly.relayout(d, newLayout)\n              }\n              catch (e) {\n                // console.log('plotly resize exception:', e);\n                // throw e;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    function resizeThrottler() {\n      // ignore resize events as long as an actualResizeHandler execution is in the queue\n      if ( !resizeTimeout ) {\n        resizeTimeout = setTimeout(function() {\n          resizeTimeout = null;\n          actualResizeHandler();\n         }, 500);\n      }\n    }\n\n\n    function finishLoad() {\n      ensureCells();\n      ensureVariables();\n      // resetAllPlayables(outputDiv, false);\n\n      if (window.twttr && window.twttr.widgets) {\n        window.twttr.widgets.load(outputDiv);\n      }\n\n      Gifffer({\n        playButtonStyles: {\n          'width': '60px',\n          'height': '60px',\n          'border-radius': '30px',\n          'background': 'rgba(200, 200, 200, 0.5)',\n          'position': 'absolute',\n          'top': '50%',\n          'left': '50%',\n          'margin': '-30px 0 0 -30px'\n        },\n        playButtonIconStyles: {\n          'width': '0',\n          'height': '0',\n          'border-top': '14px solid transparent',\n          'border-bottom': '14px solid transparent',\n          'border-left': '14px solid rgba(0, 0, 0, 0.5)',\n          'position': 'absolute',\n          'left': '26px',\n          'top': '16px'\n        }\n      });\n\n      transformPlayables(outputDiv, function() {\n        if (cardLoading) {\n          cardLoading = false;\n          propagateModel();\n          updateProcesses();\n        }\n\n        if (done) {\n          done();\n        }\n      });\n    }\n    window.onresize = resizeThrottler;  // window.addEventListener(\"resize\", resizeThrottler, false);\n\n    const firstTweetIndex = md.search(/\\!\\[[^\\]]*\\]\\(https\\:\\/\\/twitter\\.com\\//);\n\n    if (firstTweetIndex >= 0) {\n      if (!twitterLoading) {\n        twitterLoading = true;\n        importScriptUrl(\n          'https://platform.twitter.com/widgets.js',\n          function () {\n            console.log('Twitter loaded... window.twttr', window.twttr);\n            finishLoad();\n          //   window.setTimeout(function () {\n          //     console.log('window.twttr.widgets.load');\n          //     window.twttr.widgets.load();\n          //   }, 5000);   // I hate myself\n          });\n      }\n      else {\n        finishLoad();\n      }\n    }\n    else {\n      finishLoad();\n    }\n  }\n\n\n  var frontMatterText = null;\n  // Try to extract front-matter\n  if (md.indexOf('\\n---\\n') === 0) {\n    var frontMatterBegin = md.slice(4);\n    var frontMatterEndIndex = frontMatterBegin.indexOf('\\n---\\n\\n');\n    if (frontMatterEndIndex >= 0) {\n      frontMatterText = frontMatterBegin.slice(0, frontMatterEndIndex);\n      md = frontMatterBegin.slice(frontMatterEndIndex + '\\n---\\n\\n'.length);\n    }\n  }\n\n  if (frontMatterText !== null) {\n    var frontMatter = jsyaml.safeLoad(frontMatterText);\n    // console.log('frontMatterText', frontMatterText);\n    // console.log('frontMatter', frontMatter);\n    // console.log('md', md.slice(0, 50));\n    outputDiv.frontMatter = frontMatter;\n  }\n\n  var result = markedModule(md, markedOpts);\n  currentRenderDiv = null;\n\n  function applyBackpatches(done) {\n    const bp = currentBackpatches[outputDiv.id];\n    var patchesUnresolved = 0;\n    bp.forEach(patch => {\n      if (patch.key) {\n        if (patch.replace) {\n          // console.log('###Resolved patch', patch.key);\n          result = result.replace(patch.key, patch.replace);\n          patch.key = null;\n        }\n        else {\n          // console.log('###Unresolved patch', patch.key);\n          ++patchesUnresolved;\n        }\n      }\n      else {\n        console.log('applyBackpatches anomaly no key', outputDiv.id, patch);\n      }\n    });\n\n    if (patchesUnresolved > 0) {\n      if (--patchesUnresolvedKludgeLimit <= 0) {\n        console.log('Aborting applyBackpatches recursion...', bp);\n      }\n      else {\n        // console.log('patchesUnresolved', patchesUnresolved, patchesUnresolvedKludgeLimit);\n        window.setTimeout(function() {\n          applyBackpatches(function() {\n            done();\n          });\n        }, 1000);\n      }\n    }\n    else {\n      done();\n    }\n  }\n\n  patchesUnresolvedKludgeLimit = 5;\n  // console.log('applyBackpatches BEGIN', outputDiv.id, currentRenderDiv);\n\n  applyBackpatches(function() {\n    if (isTesting) {\n      outputDiv.innerHTML = result;\n      propagateModel();\n      if (done) {\n        done();\n      }\n    }\n    else if (useMathJax) {\n      var renderDivId = outputDiv.id + '-render';\n      var renderDiv = document.getElementById(renderDivId);\n      if (!renderDiv) {\n        renderDiv = document.createElement('div');\n        renderDiv.id = renderDivId;\n        outputDiv.appendChild(renderDiv);\n      }\n      renderDiv.style.display = 'none';\n      renderDiv.innerHTML = result;\n\n      function finishIt() {\n        outputDiv.innerHTML = renderDiv.innerHTML;\n        completeTypeset();\n      }\n      MathJax.Hub.Typeset(renderDiv, finishIt);\n    }\n    else {\n      outputDiv.innerHTML = result;\n      completeTypeset();\n    }\n  });\n}\n\nfunction setHome(md, outputDiv, done) {\n  currentMD = md;\n  currentHomeDiv = outputDiv;\n  resetPerPageState();\n  if (useLocalForage) {\n    localForage.iterate(function(value, key, iterationNumber) {\n      // Resulting key/value pair -- this callback\n      // will be executed for every item in the\n      // database.\n      if (key.indexOf(localForageSmartdownPrefix) === 0) {\n        const varName = key.slice(localForageSmartdownPrefix.length);\n        if (value) {\n          smartdownVariables[varName] = value;\n        }\n      }\n    }).then(function() {\n      console.log('setHome RELOAD');\n\n      setSmartdown(md, outputDiv, function() {\n        ensureCells();\n        updateProcesses();\n        done();\n      });\n    }).catch(function(err) {\n      // This code runs if there were any errors\n      console.log(err);\n      done();\n    });\n  }\n  else {\n    setSmartdown(md, outputDiv, done);\n  }\n}\n\nfunction setLinkRules(_linkRules) {\n  linkRules.length = 0;\n  _linkRules.forEach(link => {\n    linkRules.push(link);\n  });\n}\n\n\n/*\nfunction forceVariable(id, newValue, type) {\n  if (type === 'number') {\n    newValue = Number(newValue);\n  }\n  try {\n    ensureCells();\n  }\n  catch (e) {\n    console.log('exception during ensureCells', id, e);\n  }\n\n  try {\n    propagateChangedVariable(id, newValue, true);\n  }\n  catch (e) {\n    console.log('exception during propagateChangedVariable', id, e);\n  }\n}\n*/\n\n\nfunction setVariable(id, newValue, type) {\n  // console.log('setVariable', id, JSON.stringify(newValue).slice(0, 20), type);\n  if (type === 'number') {\n    newValue = Number(newValue);\n  }\n  try {\n    ensureCells();\n  }\n  catch (e) {\n    console.log('exception during ensureCells', id, e);\n  }\n\n  try {\n    propagateChangedVariable(id, newValue);\n  }\n  catch (e) {\n    console.log('exception during propagateChangedVariable', id, e);\n  }\n}\n\nfunction setVariables(assignments) {\n  each(assignments, assignment => {\n    var newValue = assignment.rhs;\n    if (assignment.type === 'number') {\n      newValue = Number(newValue);\n    }\n    changeVariable(assignment.lhs, newValue);\n  });\n\n  ensureCells();\n  updateProcesses();\n}\n\n\nfunction computeStoredExpression(exprId) {\n  var entry = perPageState.expressionsRegistered[exprId];\n  if (!entry) {\n    console.log('computeStoredExpression no such expression', exprId, perPageState.expressionsRegistered);\n    // debugger;\n  }\n  else if (entry.manual) {\n    // console.log('computeStoredExpression', exprId, entry);\n    computeExpression(entry, function() {\n      updateProcesses();\n    });\n    // ensureCells();\n    // ensureVariables();\n    // propagateModel();\n  }\n}\n\n\nfunction expandStringWithSubstitutions(expr) {\n  if (expr.indexOf('`') >= 0) {\n    var newExpr = '';\n    var splits = expr.split('`');\n    for (var i = 0; i < splits.length; ++i) {\n      var prefix = splits[i];\n      newExpr += prefix;\n      if (i < splits.length - 1) {\n        var varName = splits[++i];\n        var varValue = smartdownVariables[varName];\n        if (varValue) {\n          newExpr += `${varValue}`;\n        }\n        else {\n          newExpr += `\\`${varName}\\``;\n        }\n      }\n    }\n    expr = newExpr;\n  }\n\n  return expr;\n}\n\n\nfunction computeExpression(entry, done) {\n  var {lhss: lhss, rhss: rhss, types, labelId} = entry;\n  // console.log('computeExpression', lhss, rhss, types, labelId, entry);\n\n  if (lhss.length !== rhss.length || types.length !== lhss.length) {\n    console('lhss.length !== rhss.length || types.length !== lhss.length', lhss.length, rhss.length, types.length);\n  }\n  else {\n    let numPending = 0;\n\n    for (let i = 0; i < lhss.length; ++i) {\n      let lhs = lhss[i];\n      let rhs = rhss[i];\n      let type = types[i];\n\n      rhs = expandStringWithSubstitutions(rhs);\n      if (lhs === 'TEMPLATECELLID') {\n        // PASS\n      }\n      else if (!rhs) {\n        //  smartdownVariables[lhs] = smartdownVariables[lhs] || '';\n      }\n      else if (rhs[0] === '/') {\n        rhs = rhs.slice(1);\n        if (calcHandlers) {\n          var calcParts = rhs.split(/[\\./[]/);\n          var bracketIndex = rhs.indexOf('[');\n          var slashIndex = rhs.indexOf('/');\n\n          var calcKey = calcParts[0];\n          var calcBody = rhs.slice(calcKey.length);\n          var calcHandler = calcHandlers[calcKey];\n          if (calcHandler) {\n            ++numPending;\n            calcHandler(calcKey, calcBody, function(result) {\n              // propagateChangedVariable(lhs, result);\n              const oldValue = smartdownVariables[lhs];\n              changeVariable(lhs, result);\n              if (--numPending === 0) {\n                if (done) {\n                  done();\n                }\n              }\n              // console.log('...calcHandler', lhs, oldValue, newValue, entry);\n            });\n          }\n        }\n      }\n      else {\n        var vars = '';\n        each(smartdownVariables, function (v, k) {\n          vars += ',' + k;\n        });\n        vars = vars.slice(1);\n        var vals = lodashMap(smartdownVariables, function (v, k) {\n          return v;\n        });\n\n        /* eslint no-new-func: 0 */\n        var f = new Function(vars, 'return ' + rhs + ';');\n        var newValue = f.apply({}, vals);\n        // console.log('#rhs', f, vars, rhs, vals, type);\n        if (type === 'number') {\n          newValue = Number(newValue);\n        }\n        propagateChangedVariable(lhs, newValue);\n        // const oldValue = smartdownVariables[lhs];\n        // smartdownVariables[lhs] = newValue;\n        // console.log('...', lhs, oldValue, newValue, entry);\n      }\n    }\n\n    if (numPending > 0) {\n      // console.log('computeExpression PENDING', entry, numPending);\n    }\n    else if (done) {\n      done();\n    }\n  }\n}\n\n\nfunction goToCard(cardKey) {\n  cardLoading = true;\n  if (cardLoader) {\n    cardLoader(cardKey);\n  }\n  else {\n    var that = this;\n    var modelAsMarkdown = null;\n\n    if (!cardKey || cardKey === 'Home') {\n      modelAsMarkdown = currentMD;\n    }\n    else {\n      var scriptx = smartdownScriptsMap[cardKey];\n      if (scriptx) {\n        modelAsMarkdown = scriptx.text;\n      }\n    }\n\n    if (modelAsMarkdown) {\n      setSmartdown(modelAsMarkdown, currentHomeDiv, null);\n    }\n  }\n}\n\n\nfunction loadCardsFromDocumentScripts() {\n  smartdownScripts.length = 0;\n  for (var k in smartdownScriptsMap) {\n    delete smartdownScriptsMap[k];\n  }\n  var scripts = document.scripts;\n  for (var s in scripts) {\n    var script = scripts[s];\n    if (script && script.type && script.type === 'text/x-smartdown') {\n      smartdownScripts.push(script);\n      smartdownScriptsMap[script.id] = script;\n    }\n  }\n}\n\nfunction getMedia(mediaKey) {\n  return mediaRegistry[mediaKey];\n}\n\nvar youtubeIframeAPILoaded = false;\nvar youtubeIframeAPILoadedCbs = [];\n\nfunction onYouTubeIframeAPIReady() {\n  // console.log('onYouTubeIframeAPIReady');\n  youtubeIframeAPILoaded = true;\n\n  youtubeIframeAPILoadedCbs.forEach(cb => {\n    cb();\n  });\n\n  youtubeIframeAPILoadedCbs = [];\n}\nwindow.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;\n\nfunction loadYouTubeIframeAPI(done) {\n  youtubeIframeAPILoadedCbs.push(done);\n  importScriptUrl('https://www.youtube.com/iframe_api', function() {\n    // console.log('https://www.youtube.com/iframe_api loaded');\n  });\n}\n\n\nfunction setupYouTubePlayer(div, varName) {\n  // console.log('setupYouTubePlayer', div, varName, youtubeIframeAPILoaded);\n  if (youtubeIframeAPILoaded) {\n    var playerDiv = document.getElementById(div);\n\n    var player;\n\n    // console.log('YT', Object.keys(YT), YT.Player);\n    player = new YT.Player(playerDiv, {\n        events: {\n          'onReady': function (event) {\n              // console.log('onPlayerReady', event);\n              // console.log(player);\n              smartdown.setVariable(varName, player, 'json');\n          },\n          'onStateChange': function (event) {\n            // console.log('onPlayerStateChange', event);\n          }\n        }\n    });\n  }\n  else {\n    loadYouTubeIframeAPI(function() {\n      setupYouTubePlayer(div, varName);\n    });\n  }\n}\n\n\n// YouTube API\n\nmodule.exports = {\n  tweek: null,\n  initialize: initialize,\n  jsModules: jsModules,\n  perPageState: perPageState,\n  playablesRegistered: perPageState.playablesRegistered,\n  playablesRegisteredOrder: perPageState.playablesRegisteredOrder,\n  smartdownVariables: smartdownVariables,\n  enhanceMarkedAndOpts: enhanceMarkedAndOpts,\n  partitionMultipart: partitionMultipart,\n  registerPlayable: registerPlayable,\n  playPlayable: playPlayable,\n  resetPlayable: resetPlayable,\n  toggleDebug: toggleDebug,\n  toggleDisclosure: toggleDisclosure,\n  activatePopup: activatePopup,\n  deactivatePopup: deactivatePopup,\n  toggleDisclosureButton: toggleDisclosureButton,\n  startAutoplay: startAutoplay,\n  setSmartdown: setSmartdown,\n  setHome: setHome,\n  resetVariables: resetVariables,\n  loadCardsFromDocumentScripts: loadCardsFromDocumentScripts,\n  registerExpression: registerExpression,\n  computeExpressions: computeExpressions,\n  computeStoredExpression: computeStoredExpression,\n  setVariable: setVariable,\n  // forceVariable: forceVariable,\n  setVariables: setVariables,\n  computeExpression: computeExpression,\n  goToCard: goToCard,\n  smartdownScripts: smartdownScripts,\n  smartdownScriptsMap: smartdownScriptsMap,\n  currentHomeDiv: currentHomeDiv,\n  cardLoader: cardLoader,\n  calcHandlers: calcHandlers,\n  importCssCode: importCssCode,\n  importScriptUrl: importScriptUrl,\n  importTextUrl: importTextUrl,\n  setLinkRules: setLinkRules,\n  getMedia: getMedia,\n  resetPerPageState: resetPerPageState,\n  decodeInlineScript: decodeInlineScript,\n  hljs: hljs,\n  marked: markedModule,\n  markedOpts: markedOpts,\n  Stdlib: Stdlib,\n  ldf: LDF,\n  P5Loader: P5Loader,\n  d3: null,\n  d3v5: null,\n  d3fc: null,\n  d3cloud: null,\n  topojson: null,\n  Three: Three,\n  lodashEach: lodashEach,\n  lodashMap: lodashMap,\n  jsyaml: jsyaml,\n  updateProcesses: updateProcesses,\n  cleanupOrphanedStuff: cleanupOrphanedStuff,\n  linkRules: linkRules,\n  showAugmentedCode: false,\n  version: '0.0.94',\n  baseURL: baseURL,\n  setupYouTubePlayer: setupYouTubePlayer,\n  entityEscape: entityEscape\n};\nwindow.smartdown = module.exports;\n","// extracted by mini-css-extract-plugin"],"sourceRoot":""}